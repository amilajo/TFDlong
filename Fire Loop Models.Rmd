---
title: "TFD longitudinal analyses"
author: "Amy Nematollahi and Julia Fisher"
date: "7/27/2020"
output:
  pdf_document: default
  word_document: default
---

```{r setup, echo = F}


knitr::opts_chunk$set(echo = F, comment = F, warning = F, error = F, message = F, dev = 'pdf', results = 'hide')

```


```{r load libraries, results = F}

library(dplyr)
library(tidyverse)
library(ggplot2)
library(gridExtra)
library(grid)
library(kableExtra)
library(lubridate)
library(lme4)
library(stringr)
library(car)
library(stargazer)
library(xtable)
library(car)
library(ggpubr)
library(jtools)
library(broom)
library(openxlsx)
library(tidyr)
library(tidyverse)
library(labelled)
library(tableone)
require(GGally)
require(reshape2)
require(compiler)
require(parallel)
require(boot)
require(lattice)
library(rcompanion)
library(emmeans)
library(cowplot) #ggarrange
library(gridGraphics)
library(plotly)
library(wesanderson)
library(emmeans)
library(olsrr)

```


```{r data prep, results = F}

TFDfinal <-  read.csv("/Users/amynematollahi/desktop/TFDlong2.csv", stringsAsFactors = TRUE)

firePFAS <-  read.csv("/Users/amynematollahi/desktop/firePFAS.csv", stringsAsFactors = TRUE) %>%
  mutate(Subject_Good = as.integer(Subject_Good)) %>%
  dplyr::select(SubjectID, Status, period, Fire_Days, Fire_Hours, Num_Fires, Inc.Cat) %>%
  unique()

#Include only recruits and recruit repeats
TFDlong <- firePFAS %>%
   left_join(TFDfinal, by = c("SubjectID" = "Subject_Good")) %>%
  # dplyr::select(-X, - B2M, -GADPH, -RPL19, -ACTB, - RPLP0, -Status.y) %>%
  rename(Status = Status.x, Age = Agegood, Ethnicity = EthnGood, Gender = GenderGood, Race = RaceGood, 
         BMI = BMIgood) %>%
  mutate(FireCat = ifelse(Inc.Cat == "Structure Fire", 1,
                          ifelse(is.na(Inc.Cat), NA, 2))) %>%
  filter(Status != 'Incumbent')


drop <- c("X")
TFDlong = TFDlong[,!(names(TFDlong) %in% drop)]

TFDlong <- TFDlong %>%
   dplyr::select(-smoker, -match, -Type.of.Sample, -Datebaseline, -Status, -Year_and_month_of_analysis, -TypeofSample, -period) %>%
   rename(Status = Status.y) %>%
  mutate(PFOSALOD = ifelse(PFOSA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
  mutate(nPFOALOD = ifelse(nPFOA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(nPFOSLOD = ifelse(nPFOS > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(PFDEALOD = ifelse(PFDEA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(PFHXSLOD = ifelse(PFHXS > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(PFNALOD = ifelse(PFNA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(PFUALOD = ifelse(PFUA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(SbPFOALOD = ifelse(SbPFOA > 0.07071068, "Above_LOD", "Below_LOD")) %>%
   mutate(SmPFOSLOD = ifelse(SmPFOS > 0.07071068, "Above_LOD", "Below_LOD"))

temp_fn <- function(x) ifelse(x == "Above_LOD", 1, 0)
temp_fac <- function(x) as.factor(x)
                                  

TFDlong <- TFDlong %>%
  mutate_at(vars(contains("LOD")), temp_fn) %>%
  mutate_at(vars(contains("LOD")), temp_fac) %>%
  mutate(FireCat = factor(FireCat, levels = c("Structure Fires", "Non-structure fires"))) %>%
  mutate(Status = factor(Status, levels = c("Recruit", "RecruitRepeat"))) %>%
  filter(Status != 'Incumbent') %>%
  mutate(inter.term = paste0(Ethnicity, '_', Status, '_', Gender)) %>%
  mutate(inter.term = ifelse(inter.term == 'Non-hispanic_Recruit_Male', 'NH_R_M',
                             ifelse(inter.term == 'Hispanic_Recruit_Male', 'H_R_M',
                             ifelse(inter.term == 'Hispanic_Recruit_Female', 'H_R_F',
                             ifelse(inter.term == 'Non-hispanic_RecruitRepeat_Male', 'NH_RR_M',
                             ifelse(inter.term == 'Non-hispanic_RecruitRepeat_Female', 'NH_RR_F',
                             ifelse(inter.term == 'Hispanic_RecruitRepeat_Male', 'H_RR_M',
                             ifelse(inter.term == 'Hispanic_RecruitRepeat_Female', 'H_RR_F',
                             ifelse(inter.term == 'Non-hispanic_Recruit_Female', 'NH_R_F', 'check'))))))))) %>%
  mutate(inter.term = factor(inter.term, levels = c("H_R_M", "H_RR_M", "NH_R_M", "NH_RR_M", "H_R_F", "H_RR_F", "NH_R_F", "NH_RR_F"))) %>%
  mutate(ethn.gen = paste0(Ethnicity, '_', Gender)) %>%
  mutate(ethn.gen = ifelse(ethn.gen == 'Non-hispanic_Male', 'NH_M',
                             ifelse(ethn.gen == 'Hispanic_Male', 'H_M',
                             ifelse(ethn.gen == 'Hispanic_Female', 'H_F',
                             ifelse(ethn.gen == 'Non-hispanic_Female', 'NH_F', 'check'))))) %>% 
  mutate(ethn.gen = factor(ethn.gen, levels = c("NH_M", "H_M", "NH_F", "H_F"))) %>%
  unique()

                 
              
  
sort(unique(TFDlong$inter.term)) #Hispanic_Incumbent_Female


```


```{r add in complete fire data from Alesia, results = F}


# This script reads in the fire data from Alesia.
# Written by Julia Fisher.
# julia@statlab.bio5.org

# Load needed libraries:

# Function to go through each sheet and spit out a clean data frame:
clean_up_data <- function(dta) {
  
  # Get the row numbers for which we get a subject ID.
  sub.id.rows <- which(grepl("^\\d\\d\\d\\d$", dta[, 1]))
  
  for (i in 1:length(sub.id.rows)) {
    
    # Get the row with the subject ID.
    id.row <- sub.id.rows[i]
    
    # Get the end row for this subject.
    if (i != length(sub.id.rows)) {
      end.id.row <- sub.id.rows[i + 1] - 1
    } else {
      end.id.row <- nrow(dta)
    }
    
    # Get the subject data.
    sub.dta <- dta[id.row:end.id.row, ]
    
    # Get the subject id.
    sub.id <- dta[id.row, 1]
    
    # Get the rows where it might say the fire category.
    possible.category.rows <- which(grepl("^[A-Za-z]", sub.dta[, 1])) 
    
    # Get the rows before the above rows to help us identify the fire category rows.
    prev.rows <- possible.category.rows - 1
    
    # Confirm the fire category rows.
    category.rows <- possible.category.rows[grepl("\\d{7}", sub.dta[prev.rows, 1])]
    
    # Go through each fire category for the given subject and process the data.
    for (j in 1:length(category.rows)) {
      
      # Get the row with the fire category.
      category.row <- category.rows[j]
      
      # Get the fire category.
      cur.category <- sub.dta[category.row, 1]
      
      # Get the start row for this fire category chunk.
      if (j == 1) {
        start.row <- 1
      } else {
        start.row <- category.rows[j - 1] + 1
      }
      
      # Get the end row for this fire category chunk.
      end.row <- category.row - 1
      
      # Pull the chunk of data and process the dates, times, and durations.
      cat.dta <- data.frame(SubjectID = rep(sub.id, end.row - (start.row - 1)),
                            fire_category = cur.category, 
                            incidentID = sub.dta[start.row:end.row, 1],
                            date = sub.dta[start.row:end.row, 2],
                            duration = sub.dta[start.row:end.row, 3],
                            stringsAsFactors = FALSE) %>%
        filter(grepl("\\d{7}", incidentID)) %>%
        mutate(time_tmp = gsub("\\d{4}-\\d{2}-\\d{2}T", "", date),
               time_secs = round(as.numeric(gsub("\\d{2}:\\d{2}:", "", time_tmp))),
               time_hrs_mins = gsub(":\\d{2}\\.\\d*$", "", time_tmp),
               time = paste0(time_hrs_mins, ":", as.character(time_secs)),
               date_tmp = gsub("T.*", "", date),
               date_time = as.POSIXct(paste(date_tmp, time), format = "%Y-%m-%d %H:%M:%S"),
               date = as.POSIXct(date, format = "%Y-%m-%d"),
               hrs = as.numeric(gsub(":\\d{2}:\\d{2}$", "", duration)),
               mins = as.numeric(gsub("(^\\d{2}:)|(:\\d{2}$)", "", duration)),
               secs = as.numeric(gsub("^\\d{2}:\\d{2}:", "", duration)),
               duration_in_mins = hrs*60 + mins + secs/60) %>%
        dplyr::select(SubjectID, fire_category, incidentID, date_time, date, duration, duration_in_mins)
      
      # Concatenate the data for this subject.
      if (j == 1) {
        out.sub.dta <- cat.dta
      } else {
        out.sub.dta <- rbind(out.sub.dta, cat.dta)
      }
    }
    
    # Concatenate the data for multiple subjects.
    if (i == 1) {
      out.dta <- out.sub.dta
    } else {
      out.dta <- rbind(out.dta, out.sub.dta)
    }
  }
  
  # Return the concatenated dataset.
  return(out.dta)
}


# File path
dta.file <- "/Users/amynematollahi/desktop/PWP_Fire Fighter Fire Exposure_RecruitFires.xlsx"

# Read in the first sheet:
dta1 <- read.xlsx(dta.file, sheet = 1, colNames = FALSE)
dta2 <- read.xlsx(dta.file, sheet = 2, colNames = FALSE)
dta3 <- read.xlsx(dta.file, sheet = 3, colNames = FALSE)
dta4 <- read.xlsx(dta.file, sheet = 4, colNames = FALSE)

# Run the sheets through the processing function:
out.dta1 <- clean_up_data(dta1) 
out.dta2 <- clean_up_data(dta2)
out.dta3 <- clean_up_data(dta3)
out.dta4 <- clean_up_data(dta4)

# Combine the sheets:
processed.dta <- rbind(out.dta1, out.dta2, out.dta3, out.dta4)

# The data frame processed.dta is your final, good data frame!



```

```{r, read in three subjects missing from Alesias file}

#read in subjects 2013, 2055, and 2302

dta.file.missing <- "/Users/amynematollahi/downloads/FireFighterFireExposure_2302_2055_2013.xlsx"

dta.missing <-  read.xlsx(dta.file.missing, sheet = 1, colNames = FALSE) 

out.dta.missing <- clean_up_data(dta.missing)

processed.dta2 <- rbind(out.dta.missing, processed.dta)



```


```{r data cleaning, results = F}

time.spread <- TFDlong %>%
  mutate(Status = as.character(Status)) %>%
  mutate(date = as.character(Collection_Date)) %>%
  dplyr::select(SubjectID, date, Status) %>%
  unique() %>%
  pivot_wider(names_from = Status, values_from = date) %>%
  as.data.frame() %>%
  mutate(Recruit = as.POSIXct(Recruit, format = "%Y-%m-%d"),
         RecruitRepeat = as.POSIXct(RecruitRepeat, format = "%Y-%m-%d")) %>%
  mutate(SubjectID = as.character(SubjectID)) %>%
  left_join(processed.dta2, by = 'SubjectID') %>%
  mutate(time.chunk = ifelse(date_time <= Recruit, 'before_time_1',
                             ifelse(date_time > Recruit & date_time <= RecruitRepeat, 'between_time_1_and_2',
                                    ifelse(date_time > RecruitRepeat, 'after_time_2', 'weird'))), 
         dummy.col = 1,
         time_between_visits = RecruitRepeat - Recruit)
  
  total.runs = time.spread %>%
  group_by(SubjectID, time.chunk) %>%
  summarise(total.duration = sum(duration_in_mins), 
            total.num.fireruns = sum(dummy.col)) %>%
  ungroup %>%
  as.data.frame %>%
  filter(time.chunk != 'after_time_2') 
  
  str_runs = time.spread %>%
  group_by(SubjectID, time.chunk, fire_category) %>%
  summarise(str.duration = sum(duration_in_mins), 
            str.num.fireruns = sum(dummy.col)) %>%
  ungroup %>%
  as.data.frame %>%
  filter(time.chunk != 'after_time_2') %>%
    filter(fire_category ==  "Structure Fire (Inside Building)") 
  
  MRF <- time.spread %>%
    mutate(time.to.time2 = difftime(RecruitRepeat, date, units = 'days')) %>%
    dplyr::select(SubjectID, RecruitRepeat, date, time.to.time2) %>%
    filter(time.to.time2 > 0) %>%
    group_by(SubjectID) %>%
    arrange(time.to.time2) %>%
    mutate(row_num = 1:n()) %>%
    filter(row_num == 1) %>%
    ungroup %>%
    as.data.frame
  
  strcMRF <- time.spread %>%
    filter(fire_category == "Structure Fire (Inside Building)") %>%
    mutate(time.to.time2 = difftime(RecruitRepeat, date, units = 'days')) %>%
    dplyr::select(SubjectID, RecruitRepeat, date, time.to.time2) %>%
    filter(time.to.time2 > 0) %>%
    group_by(SubjectID) %>%
    arrange(time.to.time2) %>%
    mutate(row_num = 1:n()) %>%
    filter(row_num == 1) %>%
    ungroup %>%
    as.data.frame %>%
    dplyr::select(-row_num)
  
  #join up to TFDtuk
  #contact Alesia and Muath about missing fire data
  #Time since most recent fire, how to model this and represent Time 1
  #Time between blood draws, number of fires, number of structural fires, duration of fires, duration of structural fires
  #
  


```


```{r, tukey transform PFAS values, results = 'hide', fig.show = 'hide'}


TFDtuk <- TFDlong %>%
  unique() %>%
  mutate(PFOSAorig = PFOSA,
         nPFOAorig = nPFOA,
         nPFOSorig = nPFOS,
         PFDEAorig = PFDEA,
         PFHXSorig = PFHXS,
         PFNAorig = PFNA,
         PFUAorig = PFUA,
         SbPFOAorig = SbPFOA,
         SmPFOSorig = SmPFOS) %>%
  mutate(PFOSA = transformTukey(PFOSA)) %>% #lambda = -1.55
  mutate(nPFOA = transformTukey(nPFOA)) %>% #lambda = -0.4
  mutate(nPFOS = transformTukey(nPFOS)) %>% #lambda = -0.675
  mutate(PFDEA = transformTukey(PFDEA)) %>% #lambda = -0.3
  mutate(PFHXS = transformTukey(PFHXS)) %>% #lambda = -0.15
  mutate(PFNA = transformTukey(PFNA)) %>% #lambda = -0.325
  mutate(PFUA = transformTukey(PFUA)) %>% #lambda = -1.325
  mutate(SbPFOA = transformTukey(SbPFOA)) %>% #lambda = -1.95
  mutate(SmPFOS = transformTukey(SmPFOS)) %>% #lambda = -0.5
  mutate(SubjectID = as.factor(SubjectID)) 


# PFOSA.lambda <- -1.55
# nPFOA.lambda <- -0.4
# nPFOS.lambda <- -0.675
# PFDEA.lambda <- -0.3
# PFHXS.lambda <- -0.15
# PFNA.lambda <- -0.325
# PFUA.lambda <- -1.325
# SbPFOA.lambda <- -1.95
# SmPFOS.lambda <- -0.5
  
#   if (lambda >  0){TRANS = x ^ lambda}
# if (lambda == 0){TRANS = log(x)} 
# if (lambda <  0){TRANS = -1 * x ^ lambda} 

#TFDtuk[which(TFDtuk$inter.term == "NH_R_F"), ]
```


```{r plot for all three factors, echo = F, eval = F}


getOption('xtable.comment',TRUE)
options(xtable.comment = FALSE)

lod.table4 <- print(CreateTableOne(vars = c('inter.term', 'PFOSALOD', 'nPFOALOD', "nPFOSLOD",
                                            "PFDEALOD", "PFHXSLOD", "PFNALOD",
                                            "PFUALOD", "SbPFOALOD", "SmPFOSLOD"),
                                   data = TFDtuk,
                                   includeNA = TRUE, 
                                   factorVars = c('inter.term', 'PFOSALOD', 'nPFOALOD', "nPFOSLOD",
                                            "PFDEALOD", "PFHXSLOD", "PFNALOD",
                                            "PFUALOD", "SbPFOALOD", "SmPFOSLOD"),
                                   strata = 'inter.term',
                                   test = F),
                    varLabels = T,
                    showAllLevels = T)
lod.table2 <-  cbind(`Variable` = attr(lod.table4, "dimnames")[[1]], as.data.frame(lod.table4)) 
lod.string <- print(xtable(lod.table2, 
                           caption = paste0("PFAS chemicals LOD by factors. ",
                                            "Counts (\\%) for each category are given.")),
                          # align = c("r", ">{\\RaggedLeft}p{2.25in}", "c", "c", "c", "c", "c"),
                          # label = "tab:tab_lod"), 
                    sanitize.text.function = function(x){
                      x2 <- gsub("_", "\\\\_", x)
                      x3 <- gsub("%", "\\\\%", x2)
                      x4 <- gsub("\\n", "", x3)
                      return(x4)
                    },
                    include.rownames = F,
                    booktabs = T,
                    size = "footnotesize")
lod.string.final4 <- gsub(" \\\\\\\\ ", " \\\\tabularnewline ", lod.string)



```

\newpage
\begin{landscape}

```{r, results = 'asis', eval = F}

cat(noquote(lod.string.final4))

```

\end{landscape}

<!-- Should I remove subject 2009 (missing fire info) from FireTuk? -->

```{r join TFDtuk to fire exposure data, results = F}

FireTuk <- TFDtuk %>%
  left_join(time.spread %>% 
              dplyr::select(SubjectID, time_between_visits) %>%
              unique() %>%
              rename(time.since.baseline = time_between_visits),
               by = 'SubjectID') %>%
  left_join(MRF %>%
              dplyr::select(SubjectID, time.to.time2) %>%
              rename(days.since.MRF = time.to.time2), by = 'SubjectID') %>%
  left_join(str_runs %>%
              dplyr::select(SubjectID, str.duration, str.num.fireruns),
            by = 'SubjectID') %>%
  left_join(strcMRF %>%
              dplyr::select(SubjectID, time.to.time2) %>%
              rename(days.since.struc.MRF = time.to.time2), by = 'SubjectID') %>%
  left_join(total.runs %>%
              dplyr::select(SubjectID, total.duration, total.num.fireruns), by = 'SubjectID') %>%
  mutate(time.since.baseline = ifelse(Status == 'Recruit', 0, time.since.baseline),
         str.duration = ifelse(Status == 'Recruit', 0, str.duration),
         str.num.fireruns = ifelse(Status == 'Recruit', 0, str.num.fireruns),
         days.since.struc.MRF = ifelse(Status == 'Recruit', NA, days.since.struc.MRF),
         days.since.MRF = ifelse(Status == 'Recruit', NA, days.since.MRF),
         total.duration = ifelse(Status == 'Recruit', 0, total.duration),
         total.num.fireruns = ifelse(Status == 'Recruit', 0, total.num.fireruns)) %>%
  dplyr::select(-Fire_Days, -Fire_Hours, -Num_Fires, -Inc.Cat, -FF_Dur, -FireCat) %>% #remove old fire info
  unique()


```

<!-- For the densities, include a color grouping for time (1 or 2).
For the scatterplots, include lines between data points from the same person (to get a better understanding of slope).  This corresponds to a grouping for each participant ID.  We could include an additional grouping for ethnicity by gender if we want or a facet for ethnicity by gender. -->


```{r Table 1, results = 'asis', eval = F}

#Put PFAS in separate table

# TFDlong2 <- TFDlong %>%
#   dplyr::select(-Collection_Date) %>%
#   unique()


var_label(FireTuk) <- list(Status = "Firefighter Status", Gender = 'Gender',
                            Ethnicity = 'Ethnicity', 
                            days.since.MRF = 'Days Since Most Recent Fire',
                           str.duration = 'Structural Fires (Cumalitive Duration in minutes)',
                           str.num.fireruns = 'Cumulative Number of Structural Fires',
                           days.since.struc.MRF = 'Days Since Most Recent Structural Fire',
                           total.duration = 'All fires (Cumalitive Duration in minutes)',
                           total.num.fireruns = 'Cumulative Number of Fires')

# biomarkers <-  c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS", "PFNA", "PFUA", "SbPFOA", "SmPFOS")
# var_label(biomarkers) <-  '(ng/mL)'

 tableOne <- CreateTableOne(vars = c('Status', 'Gender', 'Ethnicity',
                                     'yearsFF', "days.since.MRF", "days.since.struc.MRF", 
                                     "total.num.fireruns", "str.num.fireruns", "total.duration",
                                     "str.duration"), 
                             data=FireTuk, strata = 'Status', 
                             factorVars =  c('Gender', 'Ethnicity'), includeNA = TRUE)


kableTable <- print(tableOne, showAllLevels = TRUE, varLabels = TRUE, includeNA = TRUE,
                    test = F)


printTable <- kable(kableTable, caption = 'Table 1: Recruit firefighters baseline (Recruit) and follow-up (RecruitRepeat) characteristics') %>%
kable_styling(bootstrap_options = c("hover", 'striped'), font_size = 14) 

printTable
 
save_kable(printTable, file = 'allTFDtable1.pdf')


```

```{r PFAS table, results = 'asis', eval = F}

var_label(TFDlong) <- list(Status = "Firefighter Status")

biomarkers <-  c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS", "PFNA", "PFUA", "SbPFOA", "SmPFOS")
var_label(biomarkers) <-  '(ng/mL)'

 tableOne <- CreateTableOne(vars = c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS",
                                     "PFNA", "PFUA",
                                     "SbPFOA", "SmPFOS"), 
                             data=TFDlong, strata = 'Status', test = FALSE)


kableTable <- print(tableOne, showAllLevels = FALSE, nonnormal = biomarkers, varLabels = TRUE, includeNA = TRUE)


printTable <- kable(kableTable, caption = 'Table 2: Recruit firefighters PFAS serum levels') %>%
kable_styling(bootstrap_options = c("hover", 'striped'), font_size = 12) 

printTable



```

```{r plot PFAS/fire type, eval = F}

#Fire type
# Create two label vectors to allow easier labeling in the plots:
pfas_analyte_labels = c("PFOSA", 
                        "n-PFOA", 
                        "n-PFOS", 
                        "PFDeA", 
                        "PFHxS", 
                        "PFNA", 
                        "PFUA", 
                        "Sb-PFOA",
                        "Sm-PFOS")
names(pfas_analyte_labels) <- c("PFOSAorig",
                               "nPFOAorig",
                               "nPFOSorig",
                               "PFDEAorig",
                               "PFHXSorig",
                               "PFNAorig",
                               "PFUAorig",
                               "SbPFOAorig",
                               "SmPFOSorig")

df <- melt(FireTuk, id.vars = "Status", measure.vars = c('PFOSAorig', 'nPFOAorig', 'nPFOSorig', 'PFDEAorig',
                                                         'PFHXSorig', 'PFNAorig', 'PFUAorig', 'SbPFOAorig',
                                                         'SmPFOSorig'))

ggplot(df, aes(x = Status, y = log(value), fill = Status)) +
  geom_boxplot(position = position_dodge(), na.rm = TRUE) +
  facet_grid(. ~ variable,
             labeller = labeller(variable = pfas_analyte_labels)) +
  guides(fill = FALSE) +
  labs(x = "Study Period",
       y = "log(Lab Value)",
       title = "PFAS Analyte Values for Recruits at Baseline and Follow-up") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_discrete(labels = c("Baseline", "Follow-up"), name="Study Period")


```

```{r ggplots with time, results = "asis", dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, eval = F}

ggplot(FireTuk, aes(x = total.duration, fill = Status)) +
  geom_rug() +
  geom_histogram() +
   labs(x = "Fireruns Duration (min)", y = "Participant Count", 
               title = "Total Duration of Fireruns at Baseline and Follow-up") +
  theme_bw() +
  scale_fill_discrete(name = "Period", labels = c("Baseline", "Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(FireTuk, aes(x = str.duration, fill = Status)) +
  geom_rug() +
  geom_histogram() +
  theme_bw() +
  labs(x = "Structural Fireruns Duration (min)", y = "Participant Count", 
               title = "Duration of Structural Fireruns at Baseline and Follow-up") +
  scale_fill_discrete(name = "Period", labels = c("Baseline", "Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5)) 

ggplot(FireTuk, aes(x = total.num.fireruns, fill = Status)) +
  geom_rug() +
  geom_histogram() +
  theme_bw() +
  labs(x = "Number of Fireruns", y = "Participant Count", 
               title = "Total Fireruns at Baseline and Follow-up") +
  scale_fill_discrete(name = "Period", labels = c("Baseline", "Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(FireTuk, aes(x = str.num.fireruns, fill = Status)) +
  geom_rug() +
  geom_histogram() +
  theme_bw() +
  labs(x = "Number of Structural Fireruns", y = "Participant Count", 
               title = "Total Structural Fireruns at Baseline and Follow-up") +
  scale_fill_discrete(name = "Period", labels = c("Baseline", "Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(subset(FireTuk, Status %in% c("RecruitRepeat")), 
        aes(x = days.since.MRF, fill = Status)) +
  geom_rug() +
  geom_histogram() +
  theme_bw() +
   labs(x = "Days Since Most Recent Firerun", y = "Participant Count", 
               title = "Days Since Baseline of Most Recent Firerun") +
  scale_fill_discrete(name = "Period", labels = c("Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(legend.position = "none")

ggplot(subset(FireTuk, Status %in% c("RecruitRepeat")), 
       aes(x = days.since.struc.MRF, fill = Status)) +
  geom_rug() +
  geom_histogram() +
  theme_bw() +
  labs(x = "Days Since Most Recent Structural Firerun", y = "Participant Count", 
               title = "Days Since Baseline of Most Recent Structural Firerun") +
  scale_fill_discrete(name = "Period", labels = c("Follow-up")) +
  scale_fill_manual(values = wes_palette(n = 2, name = "Zissou1")) +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(legend.position = "none")


  
```


```{r exposure scatterplots, results = "asis", dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11, eval = F}
knitr::knit_hooks$set(optipng = knitr::hook_optipng)

plot1 <- ggplot(FireTuk, aes(x = time.since.baseline, y = PFOSAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "PFOSA concentration (ng/mL)", 
               title = "PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))
        

plot2 <- ggplot(FireTuk, aes(x = time.since.baseline, y = nPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "nPFOA concentration (ng/mL)", 
               title = "nPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot3 <- ggplot(FireTuk, aes(x = time.since.baseline, y = nPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "nPFOS concentration (ng/mL)", 
               title = "nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))
 
plot4 <- ggplot(FireTuk, aes(x = time.since.baseline, y = PFDEAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "PFDeA concentration (ng/mL)", 
               title = "PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot5 <- ggplot(FireTuk, aes(x = time.since.baseline, y = PFHXSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "PFHxS concentration (ng/mL)", 
               title = "PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot6 <- ggplot(FireTuk, aes(x = time.since.baseline, y = PFNAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "PFNA concentration (ng/mL)", 
               title = "PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot7 <- ggplot(FireTuk, aes(x = time.since.baseline, y = PFUAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "PFUA concentration (ng/mL)", 
               title = "PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot8 <- ggplot(FireTuk, aes(x = time.since.baseline, y = SbPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "SbPFOA concentration (ng/mL)", 
               title = "SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot9 <- ggplot(FireTuk, aes(x = time.since.baseline, y = SmPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Time Since Baseline (Days)", y = "SmPFOS concentration (ng/mL)", 
               title = "SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plotlist <- list(plot1, plot2, plot3, plot4, plot5, plot6, plot7, plot8, plot9)


ggarrange(plotlist = plotlist, ncol = 3, nrow = 3)

plot1a <- ggplot(FireTuk, aes(x = str.duration, y = PFOSAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "PFOSA concentration (ng/mL)", 
               title = "Structural Fires by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot2a <- ggplot(FireTuk, aes(x = str.duration, y = nPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "nPFOA concentration (ng/mL)", 
               title = "Structural Fires by nPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot3a <- ggplot(FireTuk, aes(x = str.duration, y = nPFOSorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "nPFOS concentration (ng/mL)", 
               title = "Structural Fires by nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot4a <- ggplot(FireTuk, aes(x = str.duration, y = PFDEAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "PFDeA concentration (ng/mL)", 
               title = "Structural Fires by PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot5a <- ggplot(FireTuk, aes(x = str.duration, y = PFHXSorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "PFHxS concentration (ng/mL)", 
               title = "Structural Fires by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot6a <- ggplot(FireTuk, aes(x = str.duration, y = PFNAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "PFNA concentration (ng/mL)", 
               title = "Structural Fires by PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot7a <- ggplot(FireTuk, aes(x = str.duration, y = PFUAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "PFUA concentration (ng/mL)", 
               title = "Structural Fires by PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot8a <- ggplot(FireTuk, aes(x = str.duration, y = SbPFOAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "SbPFOA concentration (ng/mL)", 
               title = "Structural Fires by SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot9a <- ggplot(FireTuk, aes(x = str.duration, y = SmPFOSorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Structural Fireruns Duration (min)", y = "SmPFOS concentration (ng/mL)", 
               title = "Structural Fires by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotlista <- list(plot1a, plot2a, plot3a, plot4a, plot5a, plot6a, plot7a, plot8a, plot9a)

ggarrange(plotlist = plotlista, ncol = 3, nrow = 3)


plot1b <- ggplot(FireTuk, aes(x = total.duration, y = PFOSAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFOSA concentration (ng/mL)", 
               title = "All Fires by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot2b <- ggplot(FireTuk, aes(x = total.duration, y = nPFOAorig, color = SubjectID)) +
           geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFOSA concentration (ng/mL)", 
               title = "All Fires by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot3b <- ggplot(FireTuk, aes(x = total.duration, y = nPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "nPFOS concentration (ng/mL)", 
               title = "All Fires by nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot4b <- ggplot(FireTuk, aes(x = total.duration, y = PFDEAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFDeA concentration (ng/mL)", 
               title = "All Fires by PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot5b <- ggplot(FireTuk, aes(x = total.duration, y = PFHXSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFHxS concentration (ng/mL)", 
               title = "All Fires by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot6b <- ggplot(FireTuk, aes(x = total.duration, y = PFNAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFNA concentration (ng/mL)", 
               title = "All Fires by PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot7b <- ggplot(FireTuk, aes(x = total.duration, y = PFUAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "PFUA concentration (ng/mL)", 
               title = "All Fires by PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot8b <- ggplot(FireTuk, aes(x = total.duration, y = SbPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "SbPFOA concentration (ng/mL)", 
               title = "All Fires by SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot9b <- ggplot(FireTuk, aes(x = total.duration, y = SmPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "All Fireruns Duration (min)", y = "SmPFOS concentration (ng/mL)", 
               title = "All Fires by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotlistb <- list(plot1b, plot2b, plot3b, plot4b, plot5b, plot6b, plot7b, plot8b, plot9b)

ggarrange(plotlist = plotlistb, ncol = 3, nrow = 3)


plot1c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = PFOSAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "PFOSA concentration (ng/mL)", 
               title = "Number of Structural Fires by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot2c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = nPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "nPFOA concentration (ng/mL)", 
               title = "Number of Structural Fires by nPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot3c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = nPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "nPFOS concentration (ng/mL)", 
               title = "Number of Structural Fires by nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot4c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = PFDEAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "PFDeA concentration (ng/mL)", 
               title = "Number of Structural Fires by PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot5c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = PFHXSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "PFHxS concentration (ng/mL)", 
               title = "Number of Structural Fires by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot6c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = PFNAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "PFNA concentration (ng/mL)", 
               title = "Number of Structural Fires by PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot7c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = PFUAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "PFUA concentration (ng/mL)", 
               title = "Number of Structural Fires by PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot8c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = SbPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "SbPFOA concentration (ng/mL)", 
               title = "Number of Structural Fires by SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot9c <- ggplot(FireTuk, aes(x = str.num.fireruns, y = SmPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Structural Fireruns", y = "SmPFOS concentration (ng/mL)", 
               title = "Number of Structural Fires by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotlistc <- list(plot1c, plot2c, plot3c, plot4c, plot5c, plot6c, plot7c, plot8c, plot9c)

ggarrange(plotlist = plotlistc, ncol = 3, nrow = 3)


plot1d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = PFOSAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "PFOSA concentration (ng/mL)", 
               title = "Number of Total Fires by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot2d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = nPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "nPFOA concentration (ng/mL)", 
               title = "Number of Total Fires by nPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot3d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = nPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "nPFOS concentration (ng/mL)", 
               title = "Number of Total Fires by nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot4d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = PFDEAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "PFDeA concentration (ng/mL)", 
               title = "Number of Total Fires by PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot5d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = PFHXSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "PFHxS concentration (ng/mL)", 
               title = "Number of Total Fires by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot6d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = PFNAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "PFNA concentration (ng/mL)", 
               title = "Number of Total Fires by PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot7d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = PFUAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "PFUA concentration (ng/mL)", 
               title = "Number of Total Fires by PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot8d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = SbPFOAorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "SbPFOA concentration (ng/mL)", 
               title = "Number of Total Fires by SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot9d <- ggplot(FireTuk, aes(x = total.num.fireruns, y = SmPFOSorig, color = SubjectID)) +
          geom_line(alpha = 0.5) +        
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Number of Total Fires", y = "SmPFOS concentration (ng/mL)", 
               title = "Number of Total Fires by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotlistd <- list(plot1d, plot2d, plot3d, plot4d, plot5d, plot6d, plot7d, plot8d, plot9d)

ggarrange(plotlist = plotlistd, ncol = 3, nrow = 3)



plot1e <- ggplot(FireTuk, aes(x = days.since.MRF, y = PFOSAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "PFOSA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by PFOSA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))


plot2e <- ggplot(FireTuk, aes(x = days.since.MRF, y = nPFOAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.3) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "nPFOA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by nPFOA Level Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot3e <- ggplot(FireTuk, aes(x = days.since.MRF, y = nPFOSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "nPFOS concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by nPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot4e <- ggplot(FireTuk, aes(x = days.since.MRF, y = PFDEAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "PFDeA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by PFDeA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot5e <- ggplot(FireTuk, aes(x = days.since.MRF, y = PFHXSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "PFHxS concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot6e <- ggplot(FireTuk, aes(x = days.since.MRF, y = PFNAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "PFNA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by PFNA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot7e <- ggplot(FireTuk, aes(x = days.since.MRF, y = PFUAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "PFUA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by PFUA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot8e <- ggplot(FireTuk, aes(x = days.since.MRF, y = SbPFOAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "SbPFOA concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by SbPFOA Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot9e <- ggplot(FireTuk, aes(x = days.since.MRF, y = SmPFOSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Fire", y = "SmPFOS concentration (ng/mL)", 
               title = "Days Since Most Recent Fire by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotliste <- list(plot1e, plot2e, plot3e, plot4e, plot5e, plot6e, plot7e, plot8e, plot9e)

ggarrange(plotlist = plotliste, ncol = 3, nrow = 3) 

plot1f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = PFOSAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "PFOSA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by PFOSA Levels") +
          theme(plot.title = element_text(hjust = 0.5))


plot2f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = nPFOAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.3) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "nPFOA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by nPFOA Level") +
          theme(plot.title = element_text(hjust = 0.5))

plot3f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = nPFOSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "nPFOS concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by nPFOS Levels") +
          theme(plot.title = element_text(hjust = 0.5))

plot4f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = PFDEAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "PFDeA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by PFDeA Levels") +
          theme(plot.title = element_text(hjust = 0.5))

plot5f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = PFHXSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "PFHxS concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by PFHxS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plot6f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = PFNAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "PFNA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by PFNA Levels") +
          theme(plot.title = element_text(hjust = 0.5))

plot7f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = PFUAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "PFUA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by PFUA Levels") +
          theme(plot.title = element_text(hjust = 0.5))

plot8f <- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = SbPFOAorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Structural Recent Fire", y = "SbPFOA concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by SbPFOA Levels") +
          theme(plot.title = element_text(hjust = 0.5))

plot9f<- ggplot(FireTuk, aes(x = days.since.struc.MRF, y = SmPFOSorig, color = SubjectID)) +
          # geom_text(aes(label = SubjectID)) +
          # geom_line(alpha = 0.5) +
          geom_point() +
          guides(color = FALSE) +
          labs(x = "Days Since Most Recent Structural Fire", y = "SmPFOS concentration (ng/mL)", 
               title = "Days Since Most Recent Structural Fire by SmPFOS Levels Over Time") +
          theme(plot.title = element_text(hjust = 0.5))

plotliste <- list(plot1f, plot2f, plot3f, plot4f, plot5f, plot6f, plot7f, plot8f, plot9f)

ggarrange(plotlist = plotliste, ncol = 3, nrow = 3) 


```

```{r nPFOA plots, eval = F}

ggplot(FireTuk, aes(x=days.since.struc.MRF)) + 
  geom_line(aes(y = SmPFOSorig), color = "darkred") + 
  geom_line(aes(y = nPFOAorig), color="steelblue", linetype="twodash") 

df <- FireTuk %>%
  select(days.since.MRF, nPFOAorig, SmPFOSorig) %>%
  gather(key = "variable", value = "value", -days.since.MRF)
head(df)

ggplot(df, aes(x = days.since.MRF, y = value)) + 
  geom_line(aes(color = variable, linetype = variable)) 

#PFOSAorig, nPFOAorig, nPFOSorig, nPFOSorig, PFDEAorig, PFHXSorig, PFNAorig, PFUAorig, SbPFOAorig, SmPFOSorig

```


```{r models, results = F, echo = F, eval = F}


#Logistical models were used for PFOSA, PFUA, and SbPFOA; all other models are continuous

#remove women from logistical models

#for continuous models do follow-up contrasts for women, avg across ethnicities (just for women)

#follow-up continuous models for logistical ...given that the analyte is observable, is there a difference
#same models as continuous, but only looking at observable LODs. What's probability of being observable? Given that you were
#observable, what's the difference in PFAS analyte. If PFAS levels are observable, then can anti-transform.


#PFOSA logistical model
pfosa.long.log <- glmer(PFOSALOD ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male'), family = binomial)
summary(pfosa.long.log)

#continuous model follow-up on logistical model for PFOSA (transformed values)
pfosa.long.cont <- lmer(PFOSA ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male', PFOSALOD == 1))
summary(pfosa.long.cont)
plot(resid(pfosa.long.cont) ~ fitted(pfosa.long.cont)) 
abline(h = 0)

#continuous model follow-up on logistical model for PFOSA (original values)
pfosa.cont.orig <- lmer(PFOSAorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male', PFOSALOD == 1))
summary(pfosa.cont.orig)
plot(resid(pfosa.cont.orig) ~ fitted(pfosa.cont.orig)) 
abline(h = 0)



#Continuous nPFOA model with transformed values + residuals
npfoa.long <- lmer(nPFOA ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(npfoa.long)
plot(resid(npfoa.long) ~ fitted(npfoa.long)) 
abline(h = 0)

#Continuous nPFOA model with original values + residuals
npfoa.long.orig <-- lmer(nPFOAorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(npfoa.long.orig)
plot(resid(npfoa.long.orig) ~ fitted(npfoa.long.orig)) 
abline(h = 0)



#Continuous nPFOS model with transformed values + residuals
npfos.long <- lmer(nPFOS ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(npfos.long)
plot(resid(npfos.long) ~ fitted(npfos.long)) 
abline(h = 0)

#Continuous nPFOS model with original values + residuals
npfos.long.orig <- lmer(nPFOSorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(npfos.long.orig)
plot(resid(npfos.long.orig) ~ fitted(npfos.long.orig)) 
abline(h = 0)



#Continuous PFDeA model with transformed values + residuals
pfdea.long <- lmer(PFDEA ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(pfdea.long)
plot(resid(pfdea.long) ~ fitted(pfdea.long)) 
abline(h = 0)

#Continuous PFDea model with original values + residuals
pfdea.long.orig <- lmer(PFDEAorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(pfdea.long.orig)
plot(resid(pfdea.long.orig) ~ fitted(pfdea.long.orig)) 
abline(h = 0)



#Continuous PFHxS model with transformed values + residuals
pfhxs.long <- lmer(PFHXS ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(pfhxs.long)
plot(resid(pfhxs.long) ~ fitted(pfhxs.long)) 
abline(h = 0)

#Continuous PFHxS model with original values + residuals
pfhxs.long.orig <- lmer(PFHXSorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(pfhxs.long.orig)
plot(resid(pfhxs.long.orig) ~ fitted(pfhxs.long.orig)) 
abline(h = 0)




#PFUA logistical model
pfua.long.log <- glmer(PFUALOD ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male'), family = binomial)
summary(pfua.long.log)

#continuous model follow-up on logistical model for PFUA with transformed values
pfua.long.cont <- lmer(PFUA ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male', PFUALOD == 1))
summary(pfua.long.cont)
plot(resid(pfua.long.cont) ~ fitted(pfua.long.cont)) 
abline(h = 0)

#continuous model follow-up on logistical model for PFUA with original values
pfua.cont.orig <- lmer(PFUAorig ~ inter.term + Age + BMI + (1|SubjectID), 
                       data = TFDtuk %>% filter(Gender == 'Male', PFUALOD == 1))
summary(pfua.cont.orig)
plot(resid(pfua.cont.orig) ~ fitted(pfua.cont.orig)) 
abline(h = 0)




#SbPFOA logistical model
sbpfoa.long.log <- glmer(SbPFOALOD ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk %>% filter(Gender == 'Male'), family = binomial)
summary(sbpfoa.long.log)

#continuous model follow-up on logistical model for SbPFOA
sbpfoa.long.cont <- lmer(SbPFOA ~ inter.term + Age + BMI + (1|SubjectID), 
                         data = TFDtuk %>% filter(Gender == 'Male', SbPFOALOD == 1))
summary(sbpfoa.long.cont)
plot(resid(sbpfoa.long.cont) ~ fitted(sbpfoa.long.cont)) 
abline(h = 0)

#SbPFOA continuous model follow-up on logistical model for SbPFOA using original values
sbpfoa.cont.orig <- lmer(SbPFOAorig ~ inter.term + Age + BMI + (1|SubjectID), 
                       data = TFDtuk %>% filter(Gender == 'Male', SbPFOALOD == 1))
summary(sbpfoa.cont.orig)
plot(resid(sbpfoa.cont.orig) ~ fitted(sbpfoa.cont.orig)) 
abline(h = 0)




#Continuous SmPFOS model with transformed values + residuals
smpfos.long <- lmer(SmPFOS ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(smpfos.long)
plot(resid(smpfos.long) ~ fitted(smpfos.long)) 
abline(h = 0)

#Continuous SmPFOS model with original values + residuals
smpfos.long.orig <- lmer(SmPFOSorig ~ inter.term + Age + BMI + (1|SubjectID), data = TFDtuk)
summary(smpfos.long.orig)
plot(resid(smpfos.long.orig) ~ fitted(smpfos.long.orig)) 
abline(h = 0)


```


```{r dataframe for Julia - logistical models, eval = F}

TFDlong.logistical <- FireTuk %>%
  dplyr::select(SubjectID, Status, Gender, Ethnicity, BMI, PFOSAorig, PFUAorig, SbPFOAorig,
                time.since.baseline, days.since.MRF, str.duration, str.num.fireruns, days.since.struc.MRF, 
                total.duration, total.num.fireruns) %>%
  mutate(str.duration.hrs = str.duration/60,
         total.duration.hrs = total.duration/60) %>%
  dplyr::select(-str.duration, -total.duration)
  
write.csv(TFDlong.logistical, file = "/Users/amynematollahi/downloads/TFDlong.logistical.csv")

```

```{r change score models, results = 'hide', echo = F, fig.show = 'hide'}

FireChange <- FireTuk %>%
  dplyr::select(SubjectID, Status, PFOSAorig, nPFOAorig, nPFOSorig, 
                PFDEAorig, PFHXSorig, PFNAorig, PFUAorig, SbPFOAorig, SmPFOSorig) %>%
  pivot_longer(names_to = "StatusByPFAS", values_to = "PFASvalue", cols = 3:11) %>%
  pivot_wider(names_from = 'Status', values_from = 'PFASvalue') %>%
  mutate(value_dif = RecruitRepeat - Recruit) %>%
  as.data.frame() %>%
  dplyr::select(-Recruit, -RecruitRepeat) %>%
  pivot_wider(names_from = "StatusByPFAS", values_from = "value_dif") %>%
  as.data.frame() %>%
  left_join(FireTuk %>% 
              filter(Status == 'RecruitRepeat') %>%
              dplyr::select(SubjectID, Status, Ethnicity, Gender, Age, BMI, time.since.baseline, days.since.MRF, str.duration,
                            str.num.fireruns, days.since.struc.MRF, total.duration, total.num.fireruns, inter.term, ethn.gen,
                            PFOSAorig, nPFOAorig, nPFOSorig, PFDEAorig, PFHXSorig, PFNAorig, PFUAorig, SbPFOAorig, SmPFOSorig), 
            by = 'SubjectID') %>%
   rename(PFOSA.baseline = PFOSAorig.y,
         nPFOA.baseline = nPFOAorig.y,
         nPFOS.baseline = nPFOSorig.y,
         PFDEA.baseline = PFDEAorig.y,
         PFHXS.baseline = PFHXSorig.y,
         PFNA.baseline = PFNAorig.y,
         PFUA.baseline = PFUAorig.y,
         SbPFOA.baseline = SbPFOAorig.y,
         SmPFOS.baseline = SmPFOSorig.y) %>%
   rename(PFOSAorig = PFOSAorig.x,
         nPFOAorig = nPFOAorig.x,
         nPFOSorig = nPFOSorig.x,
         PFDEAorig = PFDEAorig.x,
         PFHXSorig = PFHXSorig.x,
         PFNAorig = PFNAorig.x,
         PFUAorig = PFUAorig.x,
         SbPFOAorig = SbPFOAorig.x,
         SmPFOSorig = SmPFOSorig.x) %>%
  mutate(Ethnicity = factor(as.character(Ethnicity), levels = c('Non-hispanic', 'Hispanic'))) %>%
  
  #  mutate(PFOSAtrans = PFOSAorig + abs(min(.$PFOSAorig)) + 1, 
  #         PFOSAtrans = transformTukey(PFOSAtrans)) %>% 
  # mutate(nPFOAtrans = nPFOAorig + abs(min(.$nPFOAorig)) + 1,
  #        nPFOAtrans = transformTukey(nPFOAtrans)) %>% 
  # mutate(nPFOStrans = nPFOSorig + abs(min(.$nPFOSorig)) + 1,
  #        nPFOStrans = transformTukey(nPFOStrans)) %>% 
  # mutate(PFDEAtrans = PFDEAorig + abs(min(.$PFDEAorig)) + 1,
  #        PFDEAtrans = transformTukey(PFDEAtrans)) %>% 
  # mutate(PFHXStrans = PFHXSorig + abs(min(.$PFHXSorig)) + 1,
  #        PFHXStrans = transformTukey(PFHXStrans)) %>%  #transformation results in lambda of 1
  # mutate(PFNAtrans = PFNAorig + abs(min(.$PFNAorig)) + 1, 
  #        PFNAtrans = transformTukey(PFNAtrans)) %>%
   mutate(PFOSAtrans = PFOSAorig  + 11, 
          PFOSAtrans = transformTukey(PFOSAtrans)) %>% 
  mutate(nPFOAtrans = nPFOAorig + 11,
         nPFOAtrans = transformTukey(nPFOAtrans)) %>% 
  mutate(nPFOStrans = nPFOSorig + 11,
         nPFOStrans = transformTukey(nPFOStrans)) %>% 
  mutate(PFDEAtrans = PFDEAorig + 11,
         PFDEAtrans = transformTukey(PFDEAtrans)) %>% 
  mutate(PFHXStrans = PFHXSorig +  11,
         PFHXStrans = transformTukey(PFHXStrans)) %>%  #transformation results in lambda of 1
  mutate(PFNAtrans = PFNAorig + 11, 
         PFNAtrans = transformTukey(PFNAtrans)) %>%
  mutate(PFUAtrans = PFUAorig +11,
          PFUAtrans = transformTukey(PFUAtrans)) %>%
  mutate(SbPFOAtrans = SbPFOAorig +11,
        SbPFOAtrans = transformTukey(SbPFOAtrans)) %>%
  mutate(SmPFOStrans = SmPFOSorig +11,
        SmPFOStrans = transformTukey(SmPFOStrans)) %>%
  mutate(str.duration.hrs = str.duration/60,
         total.duration.hrs = total.duration/60) %>%
  filter(Gender == "Male")

min.frame <- FireChange %>%
  dplyr::select(SubjectID, PFOSAorig, nPFOAorig, nPFOSorig, PFDEAorig, PFHXSorig, PFNAorig, PFUAorig, 
                SbPFOAorig, SmPFOSorig) %>%
  pivot_longer(names_to = "analyte", values_to = "value", cols = 2:10) %>%
  group_by(analyte) %>%
  summarise(m = abs(min(value))) %>%
  ungroup() %>%
  as.data.frame() %>%
  mutate(analyte = gsub("orig", "", analyte))

mean.frame <- FireChange %>%
  dplyr::select(SubjectID, Ethnicity, PFOSAorig, nPFOAorig, nPFOSorig, PFDEAorig, PFHXSorig, PFNAorig, PFUAorig, 
                SbPFOAorig, SmPFOSorig) %>%
  pivot_longer(names_to = "analyte", values_to = "value", cols = 3:11) %>%
  group_by(analyte, Ethnicity) %>%
  summarise(mean = mean(value)) %>%
  ungroup() %>%
  as.data.frame() %>%
  mutate(analyte = gsub("orig", "", analyte))

mean.frame.trans <- FireChange %>%
  dplyr::select(SubjectID, Ethnicity, PFOSAtrans, nPFOAtrans, nPFOStrans, PFDEAtrans, PFHXStrans, PFNAtrans, PFUAtrans, 
                SbPFOAtrans, SmPFOStrans) %>%
  pivot_longer(names_to = "analyte", values_to = "value", cols = 3:11) %>%
  group_by(analyte, Ethnicity) %>%
  summarise(mean_trans = mean(value)) %>%
  ungroup() %>%
  as.data.frame() %>%
  mutate(analyte = gsub("trans", "", analyte))
  

```

```{r read_in_fire_change_debugging_Julia Tukey transformations}

# FireChange <- read.csv("/Users/Julia/Documents/StatsLab_UA/projects/Burgess/Nematollahi/data/Firefighter/FireChange.csv", header = T)
FireChange2 <- FireChange %>%
  mutate(PFOSAtrans.tmp = PFOSAorig  + 11, # We will want to go back to min(.$PFOSAorig)
         nPFOAtrans.tmp = nPFOAorig + 11,  #AN, after adding min(.$) to all: "Error in in shapiro.test(TRANS) : all 'x' values are identical
         nPFOStrans.tmp = nPFOSorig + 11,
         PFDEAtrans.tmp = PFDEAorig + 11,
         PFHXStrans.tmp = PFHXSorig +  11,
         PFNAtrans.tmp = PFNAorig + 11, 
         PFUAtrans.tmp = PFUAorig + 11,
         SbPFOAtrans.tmp = SbPFOAorig + 11,
         SmPFOStrans.tmp = SmPFOSorig + 11) %>%
  mutate(PFOSAtrans = transformTukey(PFOSAtrans.tmp, plotit = F, quiet = T),
         nPFOAtrans = transformTukey(nPFOAtrans.tmp, plotit = F, quiet = T),
         nPFOStrans = transformTukey(nPFOStrans.tmp, plotit = F, quiet = T),
         PFDEAtrans = transformTukey(PFDEAtrans.tmp, plotit = F, quiet = T),
         PFHXStrans = transformTukey(PFHXStrans.tmp, plotit = F, quiet = T),
         PFNAtrans = transformTukey(PFNAtrans.tmp, plotit = F, quiet = T),
         PFUAtrans = transformTukey(PFUAtrans.tmp, plotit = F, quiet = T),
         SbPFOAtrans = transformTukey(SbPFOAtrans.tmp, plotit = F, quiet = T),
         SmPFOStrans = transformTukey(SmPFOStrans.tmp, plotit = F, quiet = T))

# Note this for defining your lambdas if we use them again.
PFOSAlambda <- as.numeric(transformTukey(FireChange2$PFOSAtrans.tmp, plotit = F, quiet = T, returnLambda = T)) 
nPFOAlambda <- as.numeric(transformTukey(FireChange2$nPFOAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
nPFOSlambda <- as.numeric(transformTukey(FireChange2$nPFOStrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFDEAlambda <- as.numeric(transformTukey(FireChange2$PFDEAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFHXSlambda <- as.numeric(transformTukey(FireChange2$PFHXStrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFNAlambda <- as.numeric(transformTukey(FireChange2$PFNAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFUAlambda <- as.numeric(transformTukey(FireChange2$PFUAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
SbPFOAlambda <- as.numeric(transformTukey(FireChange2$SbPFOAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
SmPFOSlambda <- as.numeric(transformTukey(FireChange2$SmPFOStrans.tmp, plotit = F, quiet = T, returnLambda = T))

```

```{r Tukey Transformation lambdas, eval = F}

  # PFOSAlambda = 9.95
  # nPFOAlambda = 4.65
  # nPFOSlambda = 3.125
  # PFDEAlambda = -3.1
  # PFHXSlambda = 1.125
  # PFNAlambda = 4.6
  # PFUAlambda = -1.825
  # SbPFOAlambda = 5.95
  # SmPFOSlambda = 2.95
  # 
  
```


```{r models for change in levels, eval = F}

# For each PFAS create separate models for:
# total structural number fire runs
# total duration
# structural fire duration
# time (in years since baseline)
# time since most recent fire run
# time since MR structural fire
# total number of fireruns

#write a function for different variables

# 6/30: removed women from FireChange, removed interaction term ethn.gen and replaced with Ethnicity
#Had to change the structure of the code in the model statements a bit due to the following error:
#Error in parse(text = trans_model_statement) : 
#  <text>:1:67: unexpected '='
#1: model_trans <- lm(PFOSAtrans ~ Ethnicity + total.num.firerunsdata =

exp_fxn <-  function(dta, orig_outcome, trans_outcome, exp_outcome) {
  orig_model_statement <- paste0("model_orig <- lm(", orig_outcome,
                                 " ~ ", exp_outcome, " + Ethnicity, data = dta)")
  eval(parse(text = orig_model_statement))
  trans_model_statement <- paste0("model_trans <- lm(", trans_outcome, 
                                 " ~ ", exp_outcome, " + Ethnicity, data = dta)")
  eval(parse(text = trans_model_statement))
  out <- list(model_orig = model_orig, 
              model_trans = model_trans)
}

analytes <- c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS", "PFNA", "PFUA", "SbPFOA", "SmPFOS")
exposures <- c("total.num.fireruns", "str.num.fireruns", "total.duration.hrs", "str.duration.hrs",
               "days.since.MRF", "days.since.struc.MRF", "time.since.baseline")
model_list <- list()
mean.change <- data.frame(Ethnicity = as.character(),
                           back.trans = as.numeric(), 
                          lower.CL.back.trans = as.numeric(),
                          upper.CL.back.trans = as.numeric(),
                          emmean = as.numeric(),
                          lower.CL = as.numeric(),
                          upper.CL = as.numeric(),
                          exposure = as.character(), 
                          analyte = as.character(),
                          back.trans.orig = as.numeric(),
                          stringsAsFactors = FALSE)
                        
for (analyte in analytes) {
  model_list[[analyte]] <- list() 
  for (exposure in exposures) {
  orig_var <- paste0(analyte, "orig")
  trans_var <- paste0(analyte, "trans")
  out_info <- exp_fxn(FireChange, orig_var, trans_var, exposure)
  model_list[[analyte]][[exposure]] <- out_info
  
  meanNH <-  mean(FireChange %>% filter(Ethnicity== 'Non-hispanic') %>% .[, exposure], na.rm = TRUE)
  meanH <-  mean(FireChange %>% filter(Ethnicity== 'Hispanic') %>% .[, exposure], na.rm = TRUE)
  lambda <- eval(parse(text = paste0(analyte, "lambda")))
  NH.mean.change <- eval(parse(text = paste0("emmeans(model_list[[analyte]][[exposure]]$model_trans, 'Ethnicity', at = list(", exposure, " = meanNH))"))) %>%
    summary() %>%
    filter(Ethnicity == "Non-hispanic") %>%
    # mutate(lower.CL.back.trans = ifelse(lambda > 0, sign(lower.CL)*abs(lower.CL)^(1/lambda) ,
    #        ifelse(lambda < 0, sign(-lower.CL)*abs(-lower.CL)^(1/(lambda)),
    #               ifelse(lambda == 0, exp(lower.CL)  ,
    #                      NA)))) %>%
    # mutate(upper.CL.back.trans = ifelse(lambda > 0, sign(upper.CL)*abs(upper.CL)^(1/lambda) ,
    #        ifelse(lambda < 0, sign(-upper.CL)*abs(-upper.CL)^(1/(lambda)),
    #               ifelse(lambda == 0, exp(upper.CL)  ,
    #                      NA)))) %>%
    # mutate(back.trans = ifelse(lambda > 0, sign(emmean)*abs(emmean)^(1/lambda),
    #        ifelse(lambda < 0, sign(-emmean)*abs(-emmean)^(1/(lambda)),
    #               ifelse(lambda == 0, exp(emmean),
    #                      NA)))) %>%
    mutate(lower.CL.back.trans = ifelse(lambda > 0, lower.CL^(1/lambda),
           ifelse(lambda < 0, -lower.CL^(1/lambda),
                  ifelse(lambda == 0, exp(lower.CL),
                         NA)))) %>%
    mutate(upper.CL.back.trans = ifelse(lambda>0, upper.CL^(1/lambda),
            ifelse(lambda<0, (-upper.CL)^(1/lambda),
                  ifelse(lambda == 0, exp(upper.CL)  ,
                         NA)))) %>%
     mutate(back.trans = ifelse(lambda>0, emmean^(1/lambda),
          ifelse(lambda<0, (-emmean)^(1/lambda),
                  ifelse(lambda == 0, exp(emmean)  ,
                         NA)))) %>%
   mutate(Ethnicity = factor(as.character(Ethnicity))) %>%
    dplyr::select(Ethnicity, back.trans, lower.CL.back.trans, upper.CL.back.trans, emmean, lower.CL, upper.CL)
  
  H.mean.change <- eval(parse(text = paste0("emmeans(model_list[[analyte]][[exposure]]$model_trans, 'Ethnicity', at = list(", exposure, " = meanH))"))) %>%
   summary() %>%
    filter(Ethnicity == "Hispanic") %>%
    # mutate(lower.CL.back.trans = ifelse(lambda > 0, sign(lower.CL)*abs(lower.CL)^(1/lambda),
    #        ifelse(lambda < 0, sign(-lower.CL)*abs(-lower.CL)^(1/((lambda))),
    #               ifelse(lambda == 0, exp(lower.CL)  ,
    #                      NA)))) %>%
    # mutate(upper.CL.back.trans = ifelse(lambda > 0, sign(upper.CL)*abs(upper.CL)^(1/lambda),
    #        ifelse(lambda < 0, sign(-upper.CL)*abs(-upper.CL)^(1/((lambda)))  ,
    #               ifelse(lambda == 0, exp(upper.CL)  ,
    #                      NA)))) %>%
    #  mutate(back.trans = ifelse(lambda > 0, sign(emmean)*abs(emmean)^(1/lambda),
    #        ifelse(lambda < 0, sign(-emmean)*abs(-emmean)^(1/((lambda))),
    #               ifelse(lambda == 0, exp(emmean)  ,
    #                      NA)))) %>%
     mutate(lower.CL.back.trans = ifelse(lambda > 0, lower.CL^(1/lambda),
           ifelse(lambda < 0, -lower.CL^(1/lambda),
                  ifelse(lambda == 0, exp(lower.CL),
                         NA)))) %>%
    mutate(upper.CL.back.trans = ifelse(lambda>0, upper.CL^(1/lambda),
            ifelse(lambda<0, (-upper.CL)^(1/lambda),
                  ifelse(lambda == 0, exp(upper.CL)  ,
                         NA)))) %>%
     mutate(back.trans = ifelse(lambda>0, emmean^(1/lambda),
          ifelse(lambda<0, (-emmean)^(1/lambda),
                  ifelse(lambda == 0, exp(emmean)  ,
                         NA)))) %>%
    mutate(Ethnicity = factor(as.character(Ethnicity))) %>%
    dplyr::select(Ethnicity, back.trans, lower.CL.back.trans, upper.CL.back.trans, emmean, lower.CL, upper.CL)
  
  mean.change <- rbind(mean.change,
                       rbind(H.mean.change, NH.mean.change) %>%
                         mutate(exposure = exposure,
                          analyte = analyte) %>%
                         left_join(min.frame, by = "analyte") %>%
                         mutate(back.trans.orig = back.trans) %>%
                         # mutate(upper.CL.back.trans = upper.CL.back.trans - m - 1,
                         #        back.trans = back.trans - m - 1,
                         #        lower.CL.back.trans = lower.CL.back.trans - m - 1) %>%
                         mutate(upper.CL.back.trans = upper.CL.back.trans - 1,
                                back.trans = back.trans - 1,
                                lower.CL.back.trans = lower.CL.back.trans - 1) %>%
                         dplyr::select(-m)) 
  
  
#   if (lambda >  0){TRANS = x ^ lambda} 
# if (lambda == 0){TRANS = log(x)} 
# if (lambda <  0){TRANS = -1 * x ^ lambda} 

  }
  # ggarrange(plot(resid(out_info$model_orig) ~ fitted(out_info$model_orig)) + abline(h = 0),
  #           plot(resid(out_info$model_trans) ~ fitted(out_info$model_trans)) + abline(h = 0),
  #           qqnorm(resid(out_info$model_orig)),
  #           qqnorm(resid(out_info$model_trans)),
  #           nrow = 2, ncol = 2)
  stargazer(model_list[[analyte]][[exposures[1]]]$model_trans, 
            model_list[[analyte]][[exposures[2]]]$model_trans,
            model_list[[analyte]][[exposures[3]]]$model_trans,
            model_list[[analyte]][[exposures[4]]]$model_trans,
            title = "Transformed PFAS Model Results", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            # covariate.labels = c("Hispanic male", "Non-Hispanic female", "Hispanic female", "Total fireruns",
            #                    "Age (years)", "BMI (kg/$m^{2}$)"),
            digits = 3, font.size = "scriptsize")
stargazer(model_list[[analyte]][[exposures[5]]]$model_trans,
            model_list[[analyte]][[exposures[6]]]$model_trans,
            model_list[[analyte]][[exposures[7]]]$model_trans,
            title = "Transformed PFAS Model Results", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            # covariate.labels = c("Hispanic male", "Non-Hispanic female", "Hispanic female", "Total fireruns",
            #                    "Age (years)", "BMI (kg/$m^{2}$)"),
            digits = 3, font.size = "scriptsize")

#Give estimate of change score for hispanic and non-hispanic males
        
}


true.mean <- mean.change %>%
  filter(exposure == 'str.num.fireruns') %>%
  left_join(mean.frame, by = c("Ethnicity", "analyte")) %>%
  left_join(min.frame, by = 'analyte') %>%
  mutate(dif = back.trans.orig - mean,
         dif = round(dif, digits = 3)) 





```

```{r models for change in levels NEW, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", eval = F}

# For each PFAS create separate models for:
# total structural number fire runs
# total duration
# structural fire duration
# time (in years since baseline)
# time since most recent fire run
# time since MR structural fire
# total number of fireruns

#write a function for different variables

# 6/30: removed women from FireChange, removed interaction term ethn.gen and replaced with Ethnicity
#Had to change the structure of the code in the model statements a bit due to the following error:
#Error in parse(text = trans_model_statement) : 
#  <text>:1:67: unexpected '='
#1: model_trans <- lm(PFOSAtrans ~ Ethnicity + total.num.firerunsdata =

exp_fxn <-  function(dta, orig_outcome, trans_outcome, exp_outcome) {
  orig_model_statement <- paste0("model_orig <- lm(", orig_outcome,
                                 " ~ ", exp_outcome, " + Ethnicity, data = dta)")
  eval(parse(text = orig_model_statement))
  trans_model_statement <- paste0("model_trans <- lm(", trans_outcome, 
                                 " ~ ", exp_outcome, " + Ethnicity, data = dta)")
  eval(parse(text = trans_model_statement))
  out <- list(model_orig = model_orig, 
              model_trans = model_trans)
}

analytes <- c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS", "PFNA", "PFUA", "SbPFOA", "SmPFOS")
exposures <- c("total.num.fireruns", "str.num.fireruns", "total.duration.hrs", "str.duration.hrs",
               "days.since.MRF", "days.since.struc.MRF", "time.since.baseline")
model_list <- list()
mean.change <- data.frame(Ethnicity = as.character(),
                          emmean = as.numeric(),
                          lower.CL = as.numeric(),
                          upper.CL = as.numeric(),
                          exposure = as.character(), 
                          analyte = as.character(),
                          stringsAsFactors = FALSE)

for (analyte in analytes) {
  for (exposure in exposures) {
  orig_var <- paste0(analyte, "orig")
  trans_var <- paste0(analyte, "trans")
  out_info <- exp_fxn(FireChange, orig_var, trans_var, exposure)
  ggarrange(plot(resid(out_info$model_orig) ~ fitted(out_info$model_orig)) + abline(h = 0),
            plot(resid(out_info$model_trans) ~ fitted(out_info$model_trans)) + abline(h = 0),
            qqnorm(resid(out_info$model_orig)),
            qqnorm(resid(out_info$model_trans)),
            nrow = 2, ncol = 2)
  stargazer(out_info$model_trans)
  }
}
                        
for (analyte in analytes) {
  model_list[[analyte]] <- list() 
  for (exposure in exposures) {
    orig_var <- paste0(analyte, "orig")
    trans_var <- paste0(analyte, "trans")
    out_info <- exp_fxn(FireChange2, orig_var, trans_var, exposure)
    model_list[[analyte]][[exposure]] <- out_info
    meanNH <-  mean(FireChange2 %>% filter(Ethnicity== 'Non-hispanic') %>% .[, exposure], na.rm = TRUE)
    meanH <-  mean(FireChange2 %>% filter(Ethnicity== 'Hispanic') %>% .[, exposure], na.rm = TRUE)
    NH.mean.change <- eval(parse(text = paste0("emmeans(model_list[[analyte]][[exposure]]$model_orig, 'Ethnicity', at = list(", exposure, " = meanNH))"))) %>%
      summary() %>%
      filter(Ethnicity == "Non-hispanic")
    H.mean.change <- eval(parse(text = paste0("emmeans(model_list[[analyte]][[exposure]]$model_orig, 'Ethnicity', at = list(", exposure, " = meanH))"))) %>%
      summary() %>%
      filter(Ethnicity == "Hispanic")
    mean.change <- rbind(mean.change,
                         rbind(H.mean.change, NH.mean.change) %>%
                           mutate(exposure = exposure,
                                  analyte = analyte) %>%
                           dplyr::select(-SE, -df)) 
  }
  

  # print(ggarrange(plot(resid(out_info$model_orig) ~ fitted(out_info$model_orig)) + abline(h = 0),
  #           plot(resid(out_info$model_trans) ~ fitted(out_info$model_trans)) + abline(h = 0),
  #           qqnorm(resid(out_info$model_orig)),
  #           qqnorm(resid(out_info$model_trans)),
  #           nrow = 2, ncol = 2))
  stargazer(model_list[[analyte]][[exposures[1]]]$model_orig, 
            model_list[[analyte]][[exposures[2]]]$model_orig,
            model_list[[analyte]][[exposures[3]]]$model_orig,
            model_list[[analyte]][[exposures[4]]]$model_orig,
            title = "PFAS Change Score Model Results (No Transformation)", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            digits = 3, font.size = "scriptsize")
  stargazer(model_list[[analyte]][[exposures[5]]]$model_orig,
            model_list[[analyte]][[exposures[6]]]$model_orig,
            model_list[[analyte]][[exposures[7]]]$model_orig,
            title = "PFAS Change Score Model Results (No Transformation)", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            digits = 3, font.size = "scriptsize")
}


true.mean <- mean.change %>%
  filter(exposure == 'str.num.fireruns') %>%
  left_join(mean.frame, by = c("Ethnicity", "analyte")) # You should compare these to the scatterplots (at least by eye).



```


```{r change_score_plots, eval = F}

# !PFOSA, PFUA, Sb-PFOA
ggplot(FireChange2, aes(x = nPFOAorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = nPFOAtrans)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = nPFOSorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = nPFOStrans)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFDEAorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFDEAtrans)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFHXSorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFHXStrans)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFNAorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = PFNAtrans)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = SmPFOSorig)) +
  geom_density() +
  geom_rug()
ggplot(FireChange2, aes(x = SmPFOStrans)) +
  geom_density() +
  geom_rug()

```


```{r cooks distance function}


cooks_distance_plot <- function(mdl, st) { #added subtitle (st) in function for printing purposes
  cooksd <- cooks.distance(mdl)
  df.mdl <- length(coef(mdl))
  df.resid <- df.residual(mdl)
  cutoff <- qf(0.5, df1 = df.mdl, df2 = df.resid)
  df <- data.frame(datapoint = 1:length(cooksd),
                    cooks_distance = cooksd) %>%
    mutate(cutoff = cutoff,
           ok = ifelse(cooks_distance < cutoff, 'Fine', 'Excessive Influence'))
  p <- ggplot(df,
         aes(x = datapoint, y = cooks_distance, fill = ok)) +
    geom_bar(stat = "identity") +
    geom_hline(yintercept = cutoff, colour = "red") +
    scale_fill_manual(limits = c("Fine", "Excessive Influence"),
                      values = c("blue", "red")) +
    labs(x = "Data Point Index",
         y = "Cook's Distance",
         title = paste0("Cook's Distance with Cutoff at 50% Percentile ",
                        "of F(", df.mdl, ", ", df.resid, ") Distribution"),
         subtitle = st) +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10)) +
    guides(fill = F)
  return(list(plot = p,
              problem_indices = df[which(df$ok == 'Excessive Influence'), 'datapoint']))
}

```

```{r dfbeta function}


fbetas_plot <- function(mdl, st, t = 'one') { #added subtitle (st) for printing purposes
  # t is the cutoff selected for use in the plot.
  # It can take one of three values:  one, two, or sample size adjusted
  
  dfbetas <- dfbetas(mdl)
  df.mdl <- length(coef(mdl))
  df.resid <- df.residual(mdl)
  
  if (t == 'one') {
    cutoff <- 1
  } else if (t == 'two') {
    cutoff <- 2
  } else if (t == 'sample size adjusted') {
    cutoff <- 2/sqrt(df.mdl + df.resid)
  } else {
    print('Invalid parameter t input.  Defaulting to t = 1.')
    cutoff <- 1
  }
  
  out <- list()
  for (i in 1:ncol(dfbetas)) {
    df <- data.frame(datapoint = 1:nrow(dfbetas),
                     dfbeta = dfbetas[, i]) %>%
      mutate(cutoff = cutoff,
             ok = ifelse(dfbeta > -cutoff & dfbeta < cutoff, 'Fine', 'Excessive Influence'))
    p <- ggplot(df, aes(x = datapoint, y = dfbeta, fill = ok)) +
      geom_bar(stat = "identity") +
      geom_hline(yintercept = cutoff, colour = "red") +
      geom_hline(yintercept = -cutoff, colour = "red") +
      scale_fill_manual(limits = c("Fine", "Excessive Influence"),
                        values = c("blue", "red")) +
      labs(x = "Data Point Index",
           y = "DFBETA",
           title = paste0("DFBETA Influence Measure on ", colnames(dfbetas)[i], "\nwith Cutoff at ", round(cutoff, 2)),
           subtitle = st) +
      theme(plot.title = element_text(hjust = 0.5, size = 10),
            axis.title = element_text(size = 10)) +
      guides(fill = F)
    out[[colnames(dfbetas)[i]]] <- list(plot = p,
                                        problem_indices = df[which(df$ok == 'Excessive Influence'), 'datapoint'])
  }
  return(out)
}


```

```{r change function, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11, eval = F}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

pfas.list <-  c("PFOSAorig", "nPFOAorig", "nPFOSorig", "PFDEAorig", "PFHXSorig", "PFNAorig", "PFUAorig", 
                "SbPFOAorig", "SmPFOSorig")
pfastrans.list <- c("PFOSAtrans", "nPFOAtrans", "nPFOStrans", "PFDEAtrans", "PFHXStrans",
              "PFNAtrans", "PFUAtrans", "SbPFOAtrans", "SmPFOStrans")
fire.list <-  c("total.num.fireruns", "str.num.fireruns", "total.duration.hrs", "str.duration.hrs",
               "days.since.MRF", "days.since.struc.MRF", "time.since.baseline")

change_plot_fxn <- function(df, pfas, pfas.trans, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(", pfas, " ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_orig))
  pfas_trans <- paste0("transmdl <- lm(", pfas.trans, " ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_trans))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl)
}

for (i in 1:length(pfas.list)) {
  pfas.name <- pfas.list[i]
  Tpfas.name <- pfastrans.list[i]
  for (fire.var in fire.list) {
    out_info <- change_plot_fxn(FireChange2, pfas.name, Tpfas.name, fire.var)
    
    #FItted vs. residuals 
    orig.resid<- ggplot(data.frame(resid = resid(out_info$pfasmdl), 
                                   fitted = fitted(out_info$pfasmdl)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))
    trans.resid <- ggplot(data.frame(resid = resid(out_info$transmdl), 
                                     fitted = fitted(out_info$transmdl)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2])) 
    
    ys.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig <- (ys.orig[2] - ys.orig[1])/(xs.orig[2] - xs.orig[1])
    b.orig <- ys.orig[2] - m.orig*xs.orig[2]
    
    ys.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans <- (ys.trans[2] - ys.trans[1])/(xs.trans[2] - xs.trans[1])
    b.trans <- ys.trans[2] - m.trans*xs.trans[2]
   
  assumptions.df <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  
  assumptions.df.t <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)

qq.plot.orig <- ggplot(assumptions.df, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans <- ggplot(assumptions.df.t, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2]))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

#Cooks distance plots
cd.plot.orig <-  cooks_distance_plot(out_info$pfasmdl, 
                                     paste0(out_info$pfasmdl$terms[[2]], ": ",
                                            out_info$pfasmdl$terms[[3]][2]))

  
cd.plot.trans <- cooks_distance_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                               out_info$transmdl$terms[[3]][2]))

#DFBETA plots

fbeta1 <- fbetas_plot(out_info$pfasmdl, paste0(out_info$pfasmdl$terms[[2]], ": ",
                                                     out_info$pfasmdl$terms[[3]][2]))
fbeta2 <- fbetas_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                      out_info$transmdl$terms[[3]][2]))


plotlist.a <- list(orig.resid, trans.resid, qq.plot.orig, qq.plot.trans, 
                   cd.plot.orig$plot, cd.plot.trans$plot,
                   fbeta1$`(Intercept)`$plot, fbeta2$`(Intercept)`$plot,
                   fbeta1$EthnicityHispanic$plot, fbeta2$EthnicityHispanic$plot,
                   fbeta1[[2]][1]$plot, fbeta2[[2]][1]$plot)



print(ggarrange(plotlist = plotlist.a, nrow = 6, ncol = 2))
    
    
  }
}


```


```{r nPFOA model time.since.baseline and total.num.fireruns comaprisons, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

fire.list <-  c("total.num.fireruns", "time.since.baseline")

compare_fxn <- function(df, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_orig))
  pfas_orig_rm <- paste0("pfasmdl.rm <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ])")
  eval(parse(text = pfas_orig_rm))
  pfas_trans <- paste0("transmdl <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_trans))
  pfas_trans_rm <- paste0("transmdl.rm <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ])")
  eval(parse(text = pfas_trans_rm))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl,
              pfasmdl.rm = pfasmdl.rm,
              transmdl.rm = transmdl.rm)
}


  for (fire.var in fire.list) {
    out_info <-  compare_fxn(FireChange2, fire.var)
    
    #FItted vs. residuals 
    orig.resid<- ggplot(data.frame(resid = resid(out_info$pfasmdl), 
                                   fitted = fitted(out_info$pfasmdl)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))
    orig.resid.rm<- ggplot(data.frame(resid = resid(out_info$pfasmdl.rm), 
                                   fitted = fitted(out_info$pfasmdl.rm)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] [4] removed"))
    trans.resid <- ggplot(data.frame(resid = resid(out_info$transmdl), 
                                     fitted = fitted(out_info$transmdl)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2])) 
    trans.resid.rm <- ggplot(data.frame(resid = resid(out_info$transmdl.rm), 
                                     fitted = fitted(out_info$transmdl.rm)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2], "[40] [4] removed")) 
    
    ys.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig <- (ys.orig[2] - ys.orig[1])/(xs.orig[2] - xs.orig[1])
    b.orig <- ys.orig[2] - m.orig*xs.orig[2]
    
    ys.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig.rm <- (ys.orig.rm[2] - ys.orig.rm[1])/(xs.orig.rm[2] - xs.orig.rm[1])
    b.orig.rm <- ys.orig.rm[2] - m.orig.rm*xs.orig.rm[2]
    
    ys.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans <- (ys.trans[2] - ys.trans[1])/(xs.trans[2] - xs.trans[1])
    b.trans <- ys.trans[2] - m.trans*xs.trans[2]
    
     ys.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans.rm <- (ys.trans.rm[2] - ys.trans.rm[1])/(xs.trans.rm[2] - xs.trans.rm[1])
    b.trans.rm <- ys.trans.rm[2] - m.trans.rm*xs.trans.rm[2]
   
  assumptions.df <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.rm <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)
  
  assumptions.df.t <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.t.rm <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl.rm), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)

qq.plot.orig <- ggplot(assumptions.df, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.orig.rm <- ggplot(assumptions.df.rm, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] [4] removed"))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans <- ggplot(assumptions.df.t, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2]))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans.rm <- ggplot(assumptions.df.t.rm, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl.rm$terms[[2]], ": ",
                          out_info$transmdl.rm$terms[[3]][2], "[40] [4] removed"))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))




plotlist.a <- list(orig.resid, trans.resid, orig.resid.rm, trans.resid.rm,
                   qq.plot.orig, qq.plot.trans, qq.plot.orig.rm, qq.plot.trans.rm)



print(ggarrange(plotlist = plotlist.a, nrow = 4, ncol = 2))
    
    
  }


```


```{r nPFOA/total.num.fireruns/time.since.baseline cooks distance plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  cd.plot.orig <-  cooks_distance_plot(out_info$pfasmdl, 
                                       paste0(out_info$pfasmdl$terms[[2]], ": ",
                                              out_info$pfasmdl$terms[[3]][2]))
  
  cd.plot.orig.rm <-  cooks_distance_plot(out_info$pfasmdl.rm, 
                                          paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                 out_info$pfasmdl.rm$terms[[3]][2],
                                                 "[40] [4] removed"))
  
  cd.plot.trans <-  cooks_distance_plot(out_info$transmdl, 
                                        paste0(out_info$transmdl$terms[[2]], ": ",
                                               out_info$transmdl$terms[[3]][2]))
  
  
  cd.plot.trans.rm <- cooks_distance_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                                       out_info$transmdl.rm$terms[[3]][2], 
                                                                       "[40] [4] removed"))


plotlist.b <- list(cd.plot.orig$plot, cd.plot.trans$plot, cd.plot.orig.rm$plot, cd.plot.trans.rm$plot)

print(ggarrange(plotlist = plotlist.b, nrow = 2, ncol = 2))

}

```


```{r nPFOA/total.num.fireruns/time.since.baseline DFBETA plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  
  fbeta1 <- fbetas_plot(out_info$pfasmdl, paste0(out_info$pfasmdl$terms[[2]], ": ",
                                                 out_info$pfasmdl$terms[[3]][2]))
  fbeta2 <- fbetas_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                  out_info$transmdl$terms[[3]][2]))
  
  fbeta3 <- fbetas_plot(out_info$pfasmdl.rm, paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                    out_info$pfasmdl.rm$terms[[3]][2], "[40] [4] removed"))
  fbeta4 <- fbetas_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                     out_info$transmdl.rm$terms[[3]][2], "[40] [4] removed"))


plotlist.c <- list(fbeta1$`(Intercept)`$plot, fbeta2$`(Intercept)`$plot,
                   fbeta3$`(Intercept)`$plot, fbeta4$`(Intercept)`$plot,
                   fbeta1$EthnicityHispanic$plot, fbeta2$EthnicityHispanic$plot,
                   fbeta3$EthnicityHispanic$plot, fbeta4$EthnicityHispanic$plot,
                   fbeta1[[2]][1]$plot, fbeta2[[2]][1]$plot,
                    fbeta3[[2]][1]$plot, fbeta4[[2]][1]$plot)

print(ggarrange(plotlist = plotlist.c, nrow = 6, ncol = 2))

}

```


```{r nPFOA/str.num.fireruns/str.duration.hrs model comaprisons, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

fire.list2 <-  c("str.num.fireruns", "str.duration.hrs")

compare_fxn <- function(df, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_orig))
  pfas_orig_rm <- paste0("pfasmdl.rm <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ])")
  eval(parse(text = pfas_orig_rm))
  pfas_trans <- paste0("transmdl <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_trans))
  pfas_trans_rm <- paste0("transmdl.rm <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ])")
  eval(parse(text = pfas_trans_rm))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl,
              pfasmdl.rm = pfasmdl.rm,
              transmdl.rm = transmdl.rm)
}


  for (fire.var in fire.list2) {
    out_info <-  compare_fxn(FireChange2, fire.var)
    
    #FItted vs. residuals 
    orig.resid<- ggplot(data.frame(resid = resid(out_info$pfasmdl), 
                                   fitted = fitted(out_info$pfasmdl)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))
    orig.resid.rm<- ggplot(data.frame(resid = resid(out_info$pfasmdl.rm), 
                                   fitted = fitted(out_info$pfasmdl.rm)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
    trans.resid <- ggplot(data.frame(resid = resid(out_info$transmdl), 
                                     fitted = fitted(out_info$transmdl)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2])) 
    trans.resid.rm <- ggplot(data.frame(resid = resid(out_info$transmdl.rm), 
                                     fitted = fitted(out_info$transmdl.rm)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2], "[40] removed")) 
    
    ys.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig <- (ys.orig[2] - ys.orig[1])/(xs.orig[2] - xs.orig[1])
    b.orig <- ys.orig[2] - m.orig*xs.orig[2]
    
    ys.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig.rm <- (ys.orig.rm[2] - ys.orig.rm[1])/(xs.orig.rm[2] - xs.orig.rm[1])
    b.orig.rm <- ys.orig.rm[2] - m.orig.rm*xs.orig.rm[2]
    
    ys.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans <- (ys.trans[2] - ys.trans[1])/(xs.trans[2] - xs.trans[1])
    b.trans <- ys.trans[2] - m.trans*xs.trans[2]
    
     ys.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans.rm <- (ys.trans.rm[2] - ys.trans.rm[1])/(xs.trans.rm[2] - xs.trans.rm[1])
    b.trans.rm <- ys.trans.rm[2] - m.trans.rm*xs.trans.rm[2]
   
  assumptions.df <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.rm <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)
  
  assumptions.df.t <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.t.rm <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl.rm), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)

qq.plot.orig <- ggplot(assumptions.df, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.orig.rm <- ggplot(assumptions.df.rm, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans <- ggplot(assumptions.df.t, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2]))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans.rm <- ggplot(assumptions.df.t.rm, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl.rm$terms[[2]], ": ",
                          out_info$transmdl.rm$terms[[3]][2], "[40] removed"))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))




plotlist.a <- list(orig.resid, trans.resid, orig.resid.rm, trans.resid.rm,
                   qq.plot.orig, qq.plot.trans, qq.plot.orig.rm, qq.plot.trans.rm)



print(ggarrange(plotlist = plotlist.a, nrow = 4, ncol = 2))
    
    
  }


```


```{r nPFOA/str.num.fireruns/str.duration.hrs cooks distance plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list2) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  cd.plot.orig <-  cooks_distance_plot(out_info$pfasmdl, 
                                       paste0(out_info$pfasmdl$terms[[2]], ": ",
                                              out_info$pfasmdl$terms[[3]][2]))
  
  cd.plot.orig.rm <-  cooks_distance_plot(out_info$pfasmdl.rm, 
                                          paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                 out_info$pfasmdl.rm$terms[[3]][2],
                                                 "[40] removed"))
  
  cd.plot.trans <-  cooks_distance_plot(out_info$transmdl, 
                                        paste0(out_info$transmdl$terms[[2]], ": ",
                                               out_info$transmdl$terms[[3]][2]))
  
  cd.plot.trans.rm <- cooks_distance_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                                       out_info$transmdl.rm$terms[[3]][2], 
                                                                       "[40] removed"))


plotlist.b <- list(cd.plot.orig$plot, cd.plot.trans$plot, cd.plot.orig.rm$plot, cd.plot.trans.rm$plot)

print(ggarrange(plotlist = plotlist.b, nrow = 4, ncol = 2))

}

```


```{r nPFOA/str.num.fireruns/str.duration.hrs DFBETA plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list2) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  
  fbeta1 <- fbetas_plot(out_info$pfasmdl, paste0(out_info$pfasmdl$terms[[2]], ": ",
                                                 out_info$pfasmdl$terms[[3]][2]))
  fbeta2 <- fbetas_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                  out_info$transmdl$terms[[3]][2]))
  
  fbeta3 <- fbetas_plot(out_info$pfasmdl.rm, paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                    out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
  fbeta4 <- fbetas_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                     out_info$transmdl.rm$terms[[3]][2], "[40] removed"))


plotlist.c <- list(fbeta1$`(Intercept)`$plot, fbeta2$`(Intercept)`$plot,
                   fbeta3$`(Intercept)`$plot, fbeta4$`(Intercept)`$plot,
                   fbeta1$EthnicityHispanic$plot, fbeta2$EthnicityHispanic$plot,
                   fbeta3$EthnicityHispanic$plot, fbeta4$EthnicityHispanic$plot,
                   fbeta1[[2]][1]$plot, fbeta2[[2]][1]$plot,
                    fbeta3[[2]][1]$plot, fbeta4[[2]][1]$plot)

print(ggarrange(plotlist = plotlist.c, nrow = 6, ncol = 2))

}

```

```{r nPFOA/total.duration.hrs/days.since.MRF model comaprisons, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

fire.list3 <-  c("total.duration.hrs", "days.since.MRF")

compare_fxn <- function(df, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_orig))
  pfas_orig_rm <- paste0("pfasmdl.rm <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ])")
  eval(parse(text = pfas_orig_rm))
  pfas_trans <- paste0("transmdl <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_trans))
  pfas_trans_rm <- paste0("transmdl.rm <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ])")
  eval(parse(text = pfas_trans_rm))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl,
              pfasmdl.rm = pfasmdl.rm,
              transmdl.rm = transmdl.rm)
}


  for (fire.var in fire.list3) {
    out_info <-  compare_fxn(FireChange2, fire.var)
    
    #FItted vs. residuals 
    orig.resid<- ggplot(data.frame(resid = resid(out_info$pfasmdl), 
                                   fitted = fitted(out_info$pfasmdl)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))
    orig.resid.rm<- ggplot(data.frame(resid = resid(out_info$pfasmdl.rm), 
                                   fitted = fitted(out_info$pfasmdl.rm)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
    trans.resid <- ggplot(data.frame(resid = resid(out_info$transmdl), 
                                     fitted = fitted(out_info$transmdl)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2])) 
    trans.resid.rm <- ggplot(data.frame(resid = resid(out_info$transmdl.rm), 
                                     fitted = fitted(out_info$transmdl.rm)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2], "[40] [4] removed")) 
    
    ys.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig <- (ys.orig[2] - ys.orig[1])/(xs.orig[2] - xs.orig[1])
    b.orig <- ys.orig[2] - m.orig*xs.orig[2]
    
    ys.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig.rm <- (ys.orig.rm[2] - ys.orig.rm[1])/(xs.orig.rm[2] - xs.orig.rm[1])
    b.orig.rm <- ys.orig.rm[2] - m.orig.rm*xs.orig.rm[2]
    
    ys.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans <- (ys.trans[2] - ys.trans[1])/(xs.trans[2] - xs.trans[1])
    b.trans <- ys.trans[2] - m.trans*xs.trans[2]
    
     ys.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans.rm <- (ys.trans.rm[2] - ys.trans.rm[1])/(xs.trans.rm[2] - xs.trans.rm[1])
    b.trans.rm <- ys.trans.rm[2] - m.trans.rm*xs.trans.rm[2]
   
  assumptions.df <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.rm <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)
  
  assumptions.df.t <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.t.rm <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl.rm), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)

qq.plot.orig <- ggplot(assumptions.df, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.orig.rm <- ggplot(assumptions.df.rm, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans <- ggplot(assumptions.df.t, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2]))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans.rm <- ggplot(assumptions.df.t.rm, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl.rm$terms[[2]], ": ",
                          out_info$transmdl.rm$terms[[3]][2], "[40] [4] removed"))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))




plotlist.a <- list(orig.resid, trans.resid, orig.resid.rm, trans.resid.rm,
                   qq.plot.orig, qq.plot.trans, qq.plot.orig.rm, qq.plot.trans.rm)



print(ggarrange(plotlist = plotlist.a, nrow = 4, ncol = 2))
    
    
  }


```


```{r nPFOA/total.duration.hrs/days.since.MRF cooks distance plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list3) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  cd.plot.orig <-  cooks_distance_plot(out_info$pfasmdl, 
                                       paste0(out_info$pfasmdl$terms[[2]], ": ",
                                              out_info$pfasmdl$terms[[3]][2]))
  
  cd.plot.orig.rm <-  cooks_distance_plot(out_info$pfasmdl.rm, 
                                          paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                 out_info$pfasmdl.rm$terms[[3]][2],
                                                 "[40] removed"))
  
  cd.plot.trans <-  cooks_distance_plot(out_info$transmdl, 
                                        paste0(out_info$transmdl$terms[[2]], ": ",
                                               out_info$transmdl$terms[[3]][2]))
  
  cd.plot.trans.rm <- cooks_distance_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                                       out_info$transmdl.rm$terms[[3]][2], 
                                                                       "[40] [4] removed"))


plotlist.b <- list(cd.plot.orig$plot, cd.plot.trans$plot, cd.plot.orig.rm$plot, cd.plot.trans.rm$plot)

print(ggarrange(plotlist = plotlist.b, nrow = 4, ncol = 2))

}

```


```{r nPFOA/total.duration.hrs/days.since.MRF DFBETA plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list3) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  
  fbeta1 <- fbetas_plot(out_info$pfasmdl, paste0(out_info$pfasmdl$terms[[2]], ": ",
                                                 out_info$pfasmdl$terms[[3]][2]))
  fbeta2 <- fbetas_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                  out_info$transmdl$terms[[3]][2]))
  
  fbeta3 <- fbetas_plot(out_info$pfasmdl.rm, paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                    out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
  fbeta4 <- fbetas_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                     out_info$transmdl.rm$terms[[3]][2], "[40] [4] removed"))


plotlist.c <- list(fbeta1$`(Intercept)`$plot, fbeta2$`(Intercept)`$plot,
                   fbeta3$`(Intercept)`$plot, fbeta4$`(Intercept)`$plot,
                   fbeta1$EthnicityHispanic$plot, fbeta2$EthnicityHispanic$plot,
                   fbeta3$EthnicityHispanic$plot, fbeta4$EthnicityHispanic$plot,
                   fbeta1[[2]][1]$plot, fbeta2[[2]][1]$plot,
                    fbeta3[[2]][1]$plot, fbeta4[[2]][1]$plot)

print(ggarrange(plotlist = plotlist.c, nrow = 6, ncol = 2))

}

```


```{r nPFOA/days.since.struc.MRF model comaprisons, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", dpi = 300, fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

fire.list4 <-  c("days.since.struc.MRF")

compare_fxn <- function(df, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_orig))
  pfas_orig_rm <- paste0("pfasmdl.rm <- lm(nPFOAorig ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ])")
  eval(parse(text = pfas_orig_rm))
  pfas_trans <- paste0("transmdl <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df)")
  eval(parse(text = pfas_trans))
  pfas_trans_rm <- paste0("transmdl.rm <- lm(nPFOAtrans ~ ", fire.var, " + Ethnicity, data = df %>% 
                      .[-40, ] %>%
                      .[-4, ] %>%
                      .[-29])")
  eval(parse(text = pfas_trans_rm))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl,
              pfasmdl.rm = pfasmdl.rm,
              transmdl.rm = transmdl.rm)
}


  for (fire.var in fire.list4) {
    out_info <-  compare_fxn(FireChange2, fire.var)
    
    #FItted vs. residuals 
    orig.resid<- ggplot(data.frame(resid = resid(out_info$pfasmdl), 
                                   fitted = fitted(out_info$pfasmdl)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))
    orig.resid.rm<- ggplot(data.frame(resid = resid(out_info$pfasmdl.rm), 
                                   fitted = fitted(out_info$pfasmdl.rm)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
    trans.resid <- ggplot(data.frame(resid = resid(out_info$transmdl), 
                                     fitted = fitted(out_info$transmdl)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2])) 
    trans.resid.rm <- ggplot(data.frame(resid = resid(out_info$transmdl.rm), 
                                     fitted = fitted(out_info$transmdl.rm)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2], "[40] [4] [29] removed")) 
    
    ys.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig <- quantile(qqnorm(resid(out_info$pfasmdl), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig <- (ys.orig[2] - ys.orig[1])/(xs.orig[2] - xs.orig[1])
    b.orig <- ys.orig[2] - m.orig*xs.orig[2]
    
    ys.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y, probs = c(0.25, 0.75),
                        qtype = 7)
    xs.orig.rm <- quantile(qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75),
                        qtype = 7)
    m.orig.rm <- (ys.orig.rm[2] - ys.orig.rm[1])/(xs.orig.rm[2] - xs.orig.rm[1])
    b.orig.rm <- ys.orig.rm[2] - m.orig.rm*xs.orig.rm[2]
    
    ys.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans <- quantile(qqnorm(resid(out_info$transmdl), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans <- (ys.trans[2] - ys.trans[1])/(xs.trans[2] - xs.trans[1])
    b.trans <- ys.trans[2] - m.trans*xs.trans[2]
    
     ys.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y, 
                         probs = c(0.25, 0.75), qtype = 7)
    xs.trans.rm <- quantile(qqnorm(resid(out_info$transmdl.rm), plot.it = F)$x, probs = c(0.25, 0.75), 
                         qtype = 7)
    m.trans.rm <- (ys.trans.rm[2] - ys.trans.rm[1])/(xs.trans.rm[2] - xs.trans.rm[1])
    b.trans.rm <- ys.trans.rm[2] - m.trans.rm*xs.trans.rm[2]
   
  assumptions.df <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.rm <- data.frame(orig_qq_theor = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$x,
                               orig_qq_samp = qqnorm(resid(out_info$pfasmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)
  
  assumptions.df.t <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl), plot.it = F)$y,
                                                              stringsAsFactors = F)
  assumptions.df.t.rm <- data.frame(trans_qq_theor = qqnorm(resid(out_info$transmdl.rm), 
                                                         plot.it = F)$x,
                               trans_qq_samp = qqnorm(resid(out_info$transmdl.rm), plot.it = F)$y,
                                                              stringsAsFactors = F)

qq.plot.orig <- ggplot(assumptions.df, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl$terms[[2]], ": ",
                          out_info$pfasmdl$terms[[3]][2]))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.orig.rm <- ggplot(assumptions.df.rm, aes(x = orig_qq_theor, y = orig_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.orig, slope = m.orig) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                          out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))  +
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans <- ggplot(assumptions.df.t, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl$terms[[2]], ": ",
                          out_info$transmdl$terms[[3]][2]))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))

qq.plot.trans.rm <- ggplot(assumptions.df.t.rm, aes(x = trans_qq_theor, y = trans_qq_samp)) +
    geom_point() + 
    geom_abline(intercept = b.trans, slope = m.trans) +
    labs(x = "Theoretical Quantiles",
         y = "Sample Quantiles",
         title = paste0(out_info$transmdl.rm$terms[[2]], ": ",
                          out_info$transmdl.rm$terms[[3]][2], "[40] [4] [29] removed"))  + 
    theme(plot.title = element_text(hjust = 0.5, size = 10),
          axis.title = element_text(size = 10))




plotlist.a <- list(orig.resid, trans.resid, orig.resid.rm, trans.resid.rm,
                   qq.plot.orig, qq.plot.trans, qq.plot.orig.rm, qq.plot.trans.rm)



print(ggarrange(plotlist = plotlist.a, nrow = 4, ncol = 2))
    
    
  }


```


```{r nPFOA/days.since.struc.MRF cooks distance plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list4) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  cd.plot.orig <-  cooks_distance_plot(out_info$pfasmdl, 
                                       paste0(out_info$pfasmdl$terms[[2]], ": ",
                                              out_info$pfasmdl$terms[[3]][2]))
  
  cd.plot.orig.rm <-  cooks_distance_plot(out_info$pfasmdl.rm, 
                                          paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                 out_info$pfasmdl.rm$terms[[3]][2],
                                                 "[40] removed"))
  
  cd.plot.trans <-  cooks_distance_plot(out_info$transmdl, 
                                        paste0(out_info$transmdl$terms[[2]], ": ",
                                               out_info$transmdl$terms[[3]][2]))
  
  cd.plot.trans.rm <- cooks_distance_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                                       out_info$transmdl.rm$terms[[3]][2], 
                                                                       "[40] [4] [29] removed"))


plotlist.b <- list(cd.plot.orig$plot, cd.plot.trans$plot, cd.plot.orig.rm$plot, cd.plot.trans.rm$plot)

print(ggarrange(plotlist = plotlist.b, nrow = 4, ncol = 2))

}

```


```{r nPFOA/days.since.struc.MRF DFBETA plots, results = 'asis', fig.width = 8, fig.height = 11}

knitr::opts_template$set("kill_prefix"=list(comment=NA, null_prefix=TRUE))

for (fire.var in fire.list4) {
  out_info <-  compare_fxn(FireChange2, fire.var)
  
  fbeta1 <- fbetas_plot(out_info$pfasmdl, paste0(out_info$pfasmdl$terms[[2]], ": ",
                                                 out_info$pfasmdl$terms[[3]][2]))
  fbeta2 <- fbetas_plot(out_info$transmdl, paste0(out_info$transmdl$terms[[2]], ": ",
                                                  out_info$transmdl$terms[[3]][2]))
  
  fbeta3 <- fbetas_plot(out_info$pfasmdl.rm, paste0(out_info$pfasmdl.rm$terms[[2]], ": ",
                                                    out_info$pfasmdl.rm$terms[[3]][2], "[40] removed"))
  fbeta4 <- fbetas_plot(out_info$transmdl.rm, paste0(out_info$transmdl.rm$terms[[2]], ": ",
                                                     out_info$transmdl.rm$terms[[3]][2], "[40] [4] [29] removed"))


plotlist.c <- list(fbeta1$`(Intercept)`$plot, fbeta2$`(Intercept)`$plot,
                   fbeta3$`(Intercept)`$plot, fbeta4$`(Intercept)`$plot,
                   fbeta1$EthnicityHispanic$plot, fbeta2$EthnicityHispanic$plot,
                   fbeta3$EthnicityHispanic$plot, fbeta4$EthnicityHispanic$plot,
                   fbeta1[[2]][1]$plot, fbeta2[[2]][1]$plot,
                    fbeta3[[2]][1]$plot, fbeta4[[2]][1]$plot)

print(ggarrange(plotlist = plotlist.c, nrow = 6, ncol = 2))

}

```


```{r check nPFOA models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}

#nPFOA: total.num.fireruns 
model_nPFOA <- lm(nPFOAorig ~  total.num.fireruns + Ethnicity, data = FireChange2)
model_nPFOA.rm <- lm(nPFOAorig ~  dtotal.num.fireruns + Ethnicity, data = FireChange2 %>%
                       .[-40, ] %>%
                       .[-4, ])

Tmodel_nPFOA <- lm(nPFOAtrans ~  total.num.fireruns + Ethnicity, data = FireChange2)
Tmodel_nPFOA.rm <- lm(nPFOAtrans ~  total.num.fireruns + Ethnicity, data = FireChange2 %>%
                       .[-40, ] %>%
                       .[-4, ])

nPFOA.resid<- ggplot(data.frame(resid = resid(model_nPFOA), 
                                fitted = fitted(model_nPFOA)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: total number of fireruns")
nPFOA.resid.rm <- ggplot(data.frame(resid = resid(model_nPFOA.rm), 
                                    fitted = fitted(model_nPFOA.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-4, ], [-40, ]")

nPFOA.residT<- ggplot(data.frame(resid = resid(Tmodel_nPFOA), 
                                fitted = fitted(Tmodel_nPFOA)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: total number of fireruns")
nPFOA.resid.rmT <- ggplot(data.frame(resid = resid(Tmodel_nPFOA.rm), 
                                    fitted = fitted(Tmodel_nPFOA.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-4, ], [-40, ]")

#Cooks distance plots
cd.nPFOA1 <-  cooks_distance_plot(model_nPFOA, 
                                     paste0(model_nPFOA$terms[[2]], ": ",
                                            model_nPFOA$terms[[3]][2]))

  
cd.nPFOA2 <- cooks_distance_plot(model_nPFOA.rm, paste0(model_nPFOA.rm$terms[[2]], ": ",
                                                               model_nPFOA.rm$terms[[3]][2]))

cd.nPFOA3 <-  cooks_distance_plot(Tmodel_nPFOA, 
                                     paste0(Tmodel_nPFOA$terms[[2]], ": ",
                                            Tmodel_nPFOA$terms[[3]][2]))

  
cd.nPFOA4 <- cooks_distance_plot(Tmodel_nPFOA.rm, paste0(Tmodel_nPFOA.rm$terms[[2]], ": ",
                                                               Tmodel_nPFOA.rm$terms[[3]][2]))

#DFBETA plots

fbeta.nPFOA1 <- fbetas_plot(model_nPFOA, 
                                     paste0(model_nPFOA$terms[[2]], ": ",
                                            model_nPFOA$terms[[3]][2]))
fbeta.nPFOA2 <- fbetas_plot(model_nPFOA.rm, paste0(model_nPFOA.rm$terms[[2]], ": ",
                                                               model_nPFOA.rm$terms[[3]][2]))
fbeta.nPFOA3 <- fbetas_plot(Tmodel_nPFOA, 
                                     paste0(Tmodel_nPFOA$terms[[2]], ": ",
                                            Tmodel_nPFOA$terms[[3]][2]))
fbeta.nPFOA4 <- fbetas_plot(Tmodel_nPFOA.rm, paste0(Tmodel_nPFOA.rm$terms[[2]], ": ",
                                                               Tmodel_nPFOA.rm$terms[[3]][2]))


plotlist.nPFOA1 <- list(nPFOA.resid, nPFOA.resid.rm, nPFOA.residT, nPFOA.resid.rmT,
                        cd.nPFOA1$plot, cd.nPFOA2$plot, cd.nPFOA3$plot, cd.nPFOA4$plot,
                        fbeta.nPFOA1$`(Intercept)`$plot, fbeta.nPFOA2$`(Intercept)`$plot,
                        fbeta.nPFOA3$`(Intercept)`$plot, fbeta.nPFOA4$`(Intercept)`$plot,
                        fbeta.nPFOA1$EthnicityHispanic$plot, fbeta.nPFOA2$EthnicityHispanic$plot,
                        fbeta.nPFOA3$EthnicityHispanic$plot, fbeta.nPFOA4$EthnicityHispanic$plot,
                        fbeta.nPFOA1[[2]][1]$plot, fbeta.nPFOA2[[2]][1]$plot,
                        fbeta.nPFOA3[[2]][1]$plot, fbeta.nPFOA4[[2]][1]$plot)
print(ggarrange(plotlist = plotlist.nPFOA1, nrow = 8, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOA, model_nPFOA.rm, model_nPFOAT, model_nPFOA.rmT, title = "nPFOA: Total number of fireruns - Change Score Models 
          - 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#nPFOA: str.num.fireruns
model_nPFOA2 <- lm(nPFOAorig ~  str.num.fireruns + Ethnicity, data = FireChange2)
model_nPFOA2.rm <- lm(nPFOAorig ~  str.num.fireruns + Ethnicity, data = FireChange2 %>% 
                        .[-40, ])

model_nPFOA2T <- lm(nPFOAtrans ~  str.num.fireruns + Ethnicity, data = FireChange2)
model_nPFOA2.rmT <- lm(nPFOAtrans ~  str.num.fireruns + Ethnicity, data = FireChange2 %>% 
                        .[-40, ])

nPFOA.resid2<- ggplot(data.frame(resid = resid(model_nPFOA2), 
                                 fitted = fitted(model_nPFOA2)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: total number of structural fireruns")
nPFOA.resid2.rm <- ggplot(data.frame(resid = resid(model_nPFOA2.rm), 
                                    fitted = fitted(model_nPFOA2.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

nPFOA.resid2T<- ggplot(data.frame(resid = resid(model_nPFOA2T), 
                                 fitted = fitted(model_nPFOA2T)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: total number of structural fireruns")
nPFOA.resid2.rmT <- ggplot(data.frame(resid = resid(model_nPFOA2.rmT), 
                                    fitted = fitted(model_nPFOA2.rmT)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

  #Cooks distance plots
cd.nPFOA5 <-  cooks_distance_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))

  
cd.nPFOA6 <- cooks_distance_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))

cd.nPFOA7 <-  cooks_distance_plot(model_nPFOA2T, 
                                     paste0(model_nPFOA2T$terms[[2]], ": ",
                                            model_nPFOA2T$terms[[3]][2]))

  
cd.nPFOA8 <- cooks_distance_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))

  #DFBETA plots

fbeta.nPFOA5 <- fbetas_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))
fbeta.nPFOA6 <- fbetas_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))
fbeta.nPFOA7 <- fbetas_plot(model_nPFOA, 
                                     paste0(model_nPFOA$terms[[2]], ": ",
                                            model_nPFOA$terms[[3]][2]))
fbeta.nPFOA8 <- fbetas_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))


plotlist.nPFOA2 <- list(nPFOA.resid2, nPFOA.resid2.rm, nPFOA.resid2T, nPFOA.resid2.rmT,
                        cd.nPFOA5$plot, cd.nPFOA6$plot, cd.nPFOA7$plot, cd.nPFOA8$plot,
                        fbeta.nPFOA5$`(Intercept)`$plot, fbeta.nPFOA6$`(Intercept)`$plot,
                        fbeta.nPFOA7$`(Intercept)`$plot, fbeta.nPFOA8$`(Intercept)`$plot,
                        fbeta.nPFOA5$EthnicityHispanic$plot, fbeta.nPFOA6$EthnicityHispanic$plot,
                        fbeta.nPFOA7$EthnicityHispanic$plot, fbeta.nPFOA8$EthnicityHispanic$plot,
                        fbeta.nPFOA5[[2]][1]$plot, fbeta.nPFOA6[[2]][1]$plot,
                        fbeta.nPFOA7[[2]][1]$plot, fbeta.nPFOA8[[2]][1]$plot)
print(ggarrange(plotlist = plotlist.nPFOA2, nrow = 8, ncol = 2, font.label = list(size = 10)))


stargazer(model_nPFOA2, model_nPFOA2.rm, model_nPFOA2T, model_nPFOA2.rmT, title = "nPFOA: Total number of structural fireruns - Change
          Score Models 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#nPFOA: total.duration.hrs
model_nPFOA3 <- lm(nPFOAorig ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_nPFOA3.rm <- lm(nPFOAorig ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% .[-40, ])

model_nPFOA3T <- lm(nPFOAtrans ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_nPFOA3.rmT <- lm(nPFOAtrans ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% .[-40, ])

nPFOA.resid3<- ggplot(data.frame(resid = resid(model_nPFOA3), 
                                 fitted = fitted(model_nPFOA3)), 
                                aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: total duration of fireruns (hours)")
nPFOA.resid3.rm <- ggplot(data.frame(resid = resid(model_nPFOA3.rm), 
                                     fitted = fitted(model_nPFOA3.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

nPFOA.resid3T<- ggplot(data.frame(resid = resid(model_nPFOA3T), 
                                 fitted = fitted(model_nPFOA3T)), 
                                aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: total duration of fireruns (hours)")
nPFOA.resid3.rmT <- ggplot(data.frame(resid = resid(model_nPFOA3.rmT), 
                                     fitted = fitted(model_nPFOA3.rmT)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

  #Cooks distance plots
cd.nPFOA9 <-  cooks_distance_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))

  
cd.nPFOA10 <- cooks_distance_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))

cd.nPFOA11 <-  cooks_distance_plot(model_nPFOA2T, 
                                     paste0(model_nPFOA2T$terms[[2]], ": ",
                                            model_nPFOA2T$terms[[3]][2]))

  
cd.nPFOA12 <- cooks_distance_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))

  #DFBETA plots

fbeta.nPFOA9 <- fbetas_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))
fbeta.nPFOA10 <- fbetas_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))
fbeta.nPFOA11 <- fbetas_plot(model_nPFOA, 
                                     paste0(model_nPFOA$terms[[2]], ": ",
                                            model_nPFOA$terms[[3]][2]))
fbeta.nPFOA12 <- fbetas_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))


plotlist.nPFOA2 <- list(nPFOA.resid2, nPFOA.resid2.rm, nPFOA.resid2T, nPFOA.resid2.rmT,
                        cd.nPFOA5$plot, cd.nPFOA6$plot, cd.nPFOA7$plot, cd.nPFOA8$plot,
                        fbeta.nPFOA5$`(Intercept)`$plot, fbeta.nPFOA6$`(Intercept)`$plot,
                        fbeta.nPFOA7$`(Intercept)`$plot, fbeta.nPFOA8$`(Intercept)`$plot,
                        fbeta.nPFOA5$EthnicityHispanic$plot, fbeta.nPFOA6$EthnicityHispanic$plot,
                        fbeta.nPFOA7$EthnicityHispanic$plot, fbeta.nPFOA8$EthnicityHispanic$plot,
                        fbeta.nPFOA5[[2]][1]$plot, fbeta.nPFOA6[[2]][1]$plot,
                        fbeta.nPFOA7[[2]][1]$plot, fbeta.nPFOA8[[2]][1]$plot)
print(ggarrange(plotlist = plotlist.nPFOA2, nrow = 8, ncol = 2, font.label = list(size = 10)))

plotlist.nPFOA3 <- list(nPFOA.resid3, nPFOA.resid3.rm, nPFOA.resid3T, nPFOA.resid3.rmT)
print(ggarrange(plotlist = plotlist.nPFOA3, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOA3, model_nPFOA3.rm, model_nPFOA3T, model_nPFOA3.rmT, title = "nPFOA: total duration of fireruns (hours) - Change Score
          Models 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#nPFOA: str.duration.hrs
model_nPFOA4 <- lm(nPFOAorig ~  str.duration.hrs + Ethnicity, data = FireChange2)
model_nPFOA4.rm <- lm(nPFOAorig ~  str.duration.hrs + Ethnicity, data = FireChange2 %>% .[-40, ])
model_nPFOA4T <- lm(nPFOAtrans ~  str.duration.hrs + Ethnicity, data = FireChange2)
model_nPFOA4.rmT <- lm(nPFOAtrans ~  str.duration.hrs + Ethnicity, data = FireChange2 %>% .[-40, ])

nPFOA.resid4<- ggplot(data.frame(resid = resid(model_nPFOA4), 
                                 fitted = fitted(model_nPFOA4)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: total duration of structural fireruns (hours)")
nPFOA.resid4.rm <- ggplot(data.frame(resid = resid(model_nPFOA4.rm), 
                                     fitted = fitted(model_nPFOA4.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

nPFOA.resid4T<- ggplot(data.frame(resid = resid(model_nPFOA4T), 
                                 fitted = fitted(model_nPFOA4T)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: total duration of structural fireruns (hours)")
nPFOA.resid4.rmT <- ggplot(data.frame(resid = resid(model_nPFOA4.rmT), 
                                     fitted = fitted(model_nPFOA4.rmT)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

  #Cooks distance plots
cd.nPFOA9 <-  cooks_distance_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))

  
cd.nPFOA10 <- cooks_distance_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))

cd.nPFOA11 <-  cooks_distance_plot(model_nPFOA2T, 
                                     paste0(model_nPFOA2T$terms[[2]], ": ",
                                            model_nPFOA2T$terms[[3]][2]))

  
cd.nPFOA12 <- cooks_distance_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))

  #DFBETA plots

fbeta.nPFOA9 <- fbetas_plot(model_nPFOA2, 
                                     paste0(model_nPFOA2$terms[[2]], ": ",
                                            model_nPFOA2$terms[[3]][2]))
fbeta.nPFOA10 <- fbetas_plot(model_nPFOA2.rm, paste0(model_nPFOA2.rm$terms[[2]], ": ",
                                                               model_nPFOA2.rm$terms[[3]][2]))
fbeta.nPFOA11 <- fbetas_plot(model_nPFOA, 
                                     paste0(model_nPFOA$terms[[2]], ": ",
                                            model_nPFOA$terms[[3]][2]))
fbeta.nPFOA12 <- fbetas_plot(model_nPFOA2.rmT, paste0(model_nPFOA2.rmT$terms[[2]], ": ",
                                                               model_nPFOA2.rmT$terms[[3]][2]))


plotlist.nPFOA3 <- list(nPFOA.resid3, nPFOA.resid2.rm, nPFOA.resid2T, nPFOA.resid2.rmT,
                        cd.nPFOA5$plot, cd.nPFOA6$plot, cd.nPFOA7$plot, cd.nPFOA8$plot,
                        fbeta.nPFOA5$`(Intercept)`$plot, fbeta.nPFOA6$`(Intercept)`$plot,
                        fbeta.nPFOA7$`(Intercept)`$plot, fbeta.nPFOA8$`(Intercept)`$plot,
                        fbeta.nPFOA5$EthnicityHispanic$plot, fbeta.nPFOA6$EthnicityHispanic$plot,
                        fbeta.nPFOA7$EthnicityHispanic$plot, fbeta.nPFOA8$EthnicityHispanic$plot,
                        fbeta.nPFOA5[[2]][1]$plot, fbeta.nPFOA6[[2]][1]$plot,
                        fbeta.nPFOA7[[2]][1]$plot, fbeta.nPFOA8[[2]][1]$plot)
print(ggarrange(plotlist = plotlist.nPFOA2, nrow = 8, ncol = 2, font.label = list(size = 10)))

plotlist.nPFOA4 <- list(nPFOA.resid4, nPFOA.resid4.rm, nPFOA.resid4T, nPFOA.resid4.rmT)
print(ggarrange(plotlist = plotlist.nPFOA4, nrow = 4, ncol = 2))

stargazer(model_nPFOA4, model_nPFOA4.rm, nPFOA.resid4T, nPFOA.resid4.rmT, title = "nPFOA: total duration of structural fireruns (hours) 
          - Change Score Models - 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")



#nPFOA: days.since.MRF
model_nPFOA5 <- lm(nPFOAorig ~  days.since.MRF + Ethnicity, data = FireChange2)
model_nPFOA5.rm <- lm(nPFOAorig ~  days.since.MRF + Ethnicity, data = FireChange2 %>% .[-40, ])
model_nPFOA5T <- lm(nPFOAtrans ~  days.since.MRF + Ethnicity, data = FireChange2)
model_nPFOA5.rmT <- lm(nPFOAtrans ~  days.since.MRF + Ethnicity, data = FireChange2 %>% .[-40, ])

nPFOA.resid5<- ggplot(data.frame(resid = resid(model_nPFOA5), 
                                 fitted = fitted(model_nPFOA5)), 
                            aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: days since most recent fire")
nPFOA.resid5.rm <- ggplot(data.frame(resid = resid(model_nPFOA5.rm), 
                                     fitted = fitted(model_nPFOA5.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

nPFOA.resid5T<- ggplot(data.frame(resid = resid(model_nPFOA5T), 
                                 fitted = fitted(model_nPFOA5T)), 
                            aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: days since most recent fire")
nPFOA.resid5.rmT <- ggplot(data.frame(resid = resid(model_nPFOA5.rmT), 
                                     fitted = fitted(model_nPFOA5.rmT)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

plotlist.nPFOA5 <- list(nPFOA.resid5, nPFOA.resid5.rm, nPFOA.resid5T, nPFOA.resid5.rmT)
print(ggarrange(plotlist = plotlist.nPFOA5, nrow = 4, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOA5, model_nPFOA5.rm, nPFOA.resid5T, nPFOA.resid5.rmT, title = "nPFOA: days since most recent fire - Change Score Models - 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#nPFOA: days.since.struc.MRF
model_nPFOA6 <- lm(nPFOAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2)
model_nPFOA6.rm <- lm(nPFOAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2 %>% .[-40, ])
model_nPFOA6T <- lm(nPFOAtrans ~  days.since.struc.MRF + Ethnicity, data = FireChange2)
model_nPFOA6.rmT <- lm(nPFOAtrans ~  days.since.struc.MRF + Ethnicity, data = FireChange2 %>% .[-40, ])

nPFOA.resid6<- ggplot(data.frame(resid = resid(model_nPFOA6), 
                                 fitted = fitted(model_nPFOA6)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: days since most recent structural fire")
nPFOA.resid6.rm <- ggplot(data.frame(resid = resid(model_nPFOA6.rm), 
                                     fitted = fitted(model_nPFOA6.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

nPFOA.resid6T<- ggplot(data.frame(resid = resid(model_nPFOA6T), 
                                 fitted = fitted(model_nPFOA6T)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: days since most recent structural fire")
nPFOA.resid6.rmT <- ggplot(data.frame(resid = resid(model_nPFOA6.rmT), 
                                     fitted = fitted(model_nPFOA6.rmT)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ]")

plotlist.nPFOA6 <- list(nPFOA.resid6, nPFOA.resid6.rm, nPFOA.resid6T, nPFOA.resid6.rmT)
print(ggarrange(plotlist = plotlist.nPFOA6, nrow = 4, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOA6, model_nPFOA6.rm, nPFOA.resid6T, nPFOA.resid6.rmT, title = "nPFOA: days since most recent structural fire - 
          Change Score Models - 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#nPFOA: time.since.baseline
model_nPFOA7 <- lm(nPFOAorig ~  time.since.baseline + Ethnicity, data = FireChange2)
model_nPFOA7.rm <- lm(nPFOAorig ~  time.since.baseline + Ethnicity, data = FireChange2 %>%
                        .[-40, ] %>%
                        .[-4, ])

model_nPFOA7T <- lm(nPFOAtrans ~  time.since.baseline + Ethnicity, data = FireChange2)
model_nPFOA7.rmT <- lm(nPFOAtrans ~  time.since.baseline + Ethnicity, data = FireChange2 %>%
                        .[-40, ] %>%
                        .[-4, ])

nPFOA.resid7<- ggplot(data.frame(resid = resid(model_nPFOA7), 
                                 fitted = fitted(model_nPFOA7)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAorig: time since baseline (days)")
nPFOA.resid7.rm <- ggplot(data.frame(resid = resid(model_nPFOA7.rm), 
                                     fitted = fitted(model_nPFOA7.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ], [-4, ]")

nPFOA.resid7T<- ggplot(data.frame(resid = resid(model_nPFOA7T), 
                                 fitted = fitted(model_nPFOA7T)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOAtrans: time since baseline (days)")
nPFOA.resid7.rmT <- ggplot(data.frame(resid = resid(model_nPFOA7.rmT), 
                                     fitted = fitted(model_nPFOA7.rmT)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-40, ], [-4, ]")

plotlist.nPFOA7 <- list(nPFOA.resid7, nPFOA.resid7.rm, nPFOA.resid7T, nPFOA.resid7.rmT)
print(ggarrange(plotlist = plotlist.nPFOA7, nrow = 4, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOA7, model_nPFOA7.rm, nPFOA.resid7T, nPFOA.resid7.rmT, title = "nPFOA: time since baseline (days) - 
          Change Score Models - 1) original and 2) original - outliers removed, 3) transformed 4) transformed - outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


```

```{r check nPFOS models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}


#nPFOS: total.duration.hrs
model_nPFOS <- lm(nPFOSorig ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_nPFOS.rm <- lm(nPFOSorig ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% 
                       .[-23, ] %>%
                       .[-31, ])

nPFOS.resid<- ggplot(data.frame(resid = resid(model_nPFOS), 
                                fitted = fitted(model_nPFOS)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "nPFOSorig: total duration of fireruns (hours)")
nPFOS.resid.rm <- ggplot(data.frame(resid = resid(model_nPFOS.rm), 
                                    fitted = fitted(model_nPFOS.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-23, ], [-31, ]")

plotlist.nPFOS <- list(nPFOS.resid, nPFOS.resid.rm)
print(ggarrange(plotlist = plotlist.nPFOS, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_nPFOS, model_nPFOS.rm, title = "nPFOS: total duration of fireruns (hours) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")



```

```{r check PFDEA models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}


#PFDEA: total.duration.hrs
model_PFDEA <- lm(PFDEAorig ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_PFDEA.rm <- lm(PFDEAorig ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% .[-23, ])

PFDEA.resid<- ggplot(data.frame(resid = resid(model_PFDEA), 
                                fitted = fitted(model_PFDEA)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFDEAorig: total duration of fireruns (hours)")
PFDEA.resid.rm <- ggplot(data.frame(resid = resid(model_PFDEA.rm), 
                                    fitted = fitted(model_PFDEA.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-23, ]")

plotlist.PFDEA <- list(PFDEA.resid, PFDEA.resid.rm)
print(ggarrange(plotlist = plotlist.PFDEA, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFDEA, model_PFDEA.rm, title = "PFDEA: total duration of fireruns (hours) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFDEA: str.duration.hrs
model_PFDEA2 <- lm(PFDEAorig ~  str.duration.hrs + Ethnicity, data = FireChange2)
model_PFDEA2.rm <- lm(PFDEAorig ~  str.duration.hrs + Ethnicity, data = FireChange2 %>% 
                        .[-3, ])

PFDEA.resid2<- ggplot(data.frame(resid = resid(model_PFDEA2), 
                                 fitted = fitted(model_PFDEA2)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFDEAorig: total duration of structural fireruns (hours)")
PFDEA.resid2.rm <- ggplot(data.frame(resid = resid(model_PFDEA2.rm), 
                                     fitted = fitted(model_PFDEA2.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-3, ]")

plotlist.PFDEA2 <- list(PFDEA.resid2, PFDEA.resid2.rm)
print(ggarrange(plotlist = plotlist.PFDEA2, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFDEA2, model_PFDEA2.rm, title = "PFDEA: total duration of structural fireruns (hours) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


```

```{r check PFHXS models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}

#PFHXS: total.num.fireruns
model_PFHXS <- lm(PFHXSorig ~  total.num.fireruns + Ethnicity, data = FireChange2)
model_PFHXS.rm <- lm(PFHXSorig ~  total.num.fireruns + Ethnicity, data = FireChange2 %>% 
                       .[-31, ] %>%
                       .[-4, ] %>% 
                       .[-40, ])

PFHXS.resid<- ggplot(data.frame(resid = resid(model_PFHXS), 
                                fitted = fitted(model_PFHXS)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: total number of fireruns")
PFHXS.resid.rm <- ggplot(data.frame(resid = resid(model_PFHXS.rm), 
                                    fitted = fitted(model_PFHXS.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-4, ], [-40, ]")

plotlist.PFHXS <- list(PFHXS.resid, PFHXS.resid.rm)
print(ggarrange(plotlist = plotlist.PFHXS, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS, model_PFHXS.rm, title = "PFHXS: total number of fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFHXS: str.num.fireruns
model_PFHXS2 <- lm(PFHXSorig ~  str.num.fireruns + Ethnicity, data = FireChange2)
model_PFHXS2.rm <- lm(PFHXSorig ~  str.num.fireruns + Ethnicity, data = FireChange2 %>% 
                        .[-31, ] %>%
                        .[-4, ] %>% 
                        .[-40, ])

PFHXS.resid2<- ggplot(data.frame(resid = resid(model_PFHXS2), 
                                 fitted = fitted(model_PFHXS2)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: total number of structural fireruns")
PFHXS.resid2.rm <- ggplot(data.frame(resid = resid(model_PFHXS2.rm), 
                                     fitted = fitted(model_PFHXS2.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-4, ], [-40, ]")

plotlist.PFHXS2 <- list(PFHXS.resid2, PFHXS.resid2.rm)
print(ggarrange(plotlist = plotlist.PFHXS2, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS2, model_PFHXS2.rm, title = "PFHXS: total number of structural fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFHXS: total.duration.hrs
model_PFHXS3 <- lm(PFHXSorig ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_PFHXS3.rm <- lm(PFHXSorig ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% 
                        .[-23, ])

PFHXS.resid3<- ggplot(data.frame(resid = resid(model_PFHXS3), 
                                 fitted = fitted(model_PFHXS3)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: total duration of fireruns (hours)")
PFHXS.resid3.rm <- ggplot(data.frame(resid = resid(model_PFHXS3.rm), 
                                     fitted = fitted(model_PFHXS3.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-23, ]")

plotlist.PFHXS3 <- list(PFHXS.resid3, PFHXS.resid3.rm)
print(ggarrange(plotlist = plotlist.PFHXS3, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS3, model_PFHXS3.rm, title = "PFHXS: total duration of fireruns (hours) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFHXS: str.duration.hrs
model_PFHXS4 <- lm(PFHXSorig ~  str.duration.hrs + Ethnicity, data = FireChange2)
model_PFHXS4.rm <- lm(PFHXSorig ~  str.duration.hrs + Ethnicity, data = FireChange2 %>% 
                        .[-31, ])

PFHXS.resid4<- ggplot(data.frame(resid = resid(model_PFHXS4), 
                                 fitted = fitted(model_PFHXS4)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: total duration of structural fireruns (hours)")
PFHXS.resid4.rm <- ggplot(data.frame(resid = resid(model_PFHXS4.rm), 
                                     fitted = fitted(model_PFHXS4.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ]")

plotlist.PFHXS4 <- list(PFHXS.resid4, PFHXS.resid4.rm)
print(ggarrange(plotlist = plotlist.PFHXS4, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS4, model_PFHXS4.rm, title = "PFHXS: total duration of structural fireruns (hours) -
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


#PFHXS: days.since.MRF
model_PFHXS5 <- lm(PFHXSorig ~  days.since.MRF + Ethnicity, data = FireChange2)
model_PFHXS5.rm <- lm(PFHXSorig ~  days.since.MRF + Ethnicity, data = FireChange2 %>% 
                        .[-31, ] %>%
                        .[-40])

PFHXS.resid5<- ggplot(data.frame(resid = resid(model_PFHXS5), 
                                 fitted = fitted(model_PFHXS5)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: days since most recent fire")
PFHXS.resid5.rm <- ggplot(data.frame(resid = resid(model_PFHXS5.rm), 
                                     fitted = fitted(model_PFHXS5.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-40, ]")

plotlist.PFHXS5<- list(PFHXS.resid5, PFHXS.resid5.rm)
print(ggarrange(plotlist = plotlist.PFHXS5, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS5, model_PFHXS5.rm, title = "PFHXS: days since most recent fire - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


#PFHXS: days.since.struc.MRF
model_PFHXS6 <- lm(PFHXSorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2)
model_PFHXS6.rm <- lm(PFHXSorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2 %>% 
                        .[-31, ] %>%
                        .[-40])

PFHXS.resid6<- ggplot(data.frame(resid = resid(model_PFHXS6), 
                                 fitted = fitted(model_PFHXS6)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: days since most recent structural fire")
PFHXS.resid6.rm <- ggplot(data.frame(resid = resid(model_PFHXS6.rm), 
                                     fitted = fitted(model_PFHXS6.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-40, ]")

plotlist.PFHXS6<- list(PFHXS.resid6, PFHXS.resid6.rm)
print(ggarrange(plotlist = plotlist.PFHXS6, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS6, model_PFHXS6.rm, title = "PFHXS: days since most recent structural fire - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFHXS: time.since.baseline
model_PFHXS7 <- lm(PFHXSorig ~   time.since.baseline + Ethnicity, data = FireChange2)
model_PFHXS7.rm <- lm(PFHXSorig ~   time.since.baseline + Ethnicity, data = FireChange2 %>% 
                        .[-31, ])

PFHXS.resid7<- ggplot(data.frame(resid = resid(model_PFHXS7), 
                                 fitted = fitted(model_PFHXS7)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFHXSorig: time since baseline (days)")
PFHXS.resid7.rm <- ggplot(data.frame(resid = resid(model_PFHXS7.rm), 
                                     fitted = fitted(model_PFHXS7.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-40, ]")

plotlist.PFHXS7<- list(PFHXS.resid7, PFHXS.resid7.rm)
print(ggarrange(plotlist = plotlist.PFHXS7, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFHXS7, model_PFHXS7.rm, title = "PFHXS: time since baseline (days) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")




```

```{r check PFNA models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}


#PFNA: total.num.fireruns
model_PFNA <- lm(PFNAorig ~  total.num.fireruns + Ethnicity, data = FireChange2)
model_PFNA.rm <- lm(PFNAorig ~  total.num.fireruns + Ethnicity, data = FireChange2 %>% 
                      .[-6, ])

PFNA.resid<- ggplot(data.frame(resid = resid(model_PFNA), 
                               fitted = fitted(model_PFNA)), 
                    aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFNAorig: total number of fireruns")
PFNA.resid.rm <- ggplot(data.frame(resid = resid(model_PFNA.rm), 
                                   fitted = fitted(model_PFNA.rm)), 
                        aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA <- list(PFNA.resid, PFNA.resid.rm)
print(ggarrange(plotlist = plotlist.PFNA, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA, model_PFNA.rm, title = "PFNA: total number of fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFNA: str.num.fireruns
model_PFNA2 <- lm(PFNAorig ~  str.num.fireruns + Ethnicity, data = FireChange2)
model_PFNA2.rm <- lm(PFNAorig ~  str.num.fireruns + Ethnicity, data = FireChange2 %>% 
                       .[-6, ])

PFNA.resid2<- ggplot(data.frame(resid = resid(model_PFNA2), 
                                fitted = fitted(model_PFNA2)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFNAorig: total number of structural fireruns")
PFNA.resid2.rm <- ggplot(data.frame(resid = resid(model_PFNA2.rm), 
                                    fitted = fitted(model_PFNA2.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA2 <- list(PFNA.resid2, PFNA.resid2.rm)
print(ggarrange(plotlist = plotlist.PFNA2, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA2, model_PFNA2.rm, title = "PFNA: total number of structural fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


#PFNA: total.duration.hrs
model_PFNA3 <- lm(PFNAorig ~  total.duration.hrs + Ethnicity, data = FireChange2)
model_PFNA3.rm <- lm(PFNAorig ~  total.duration.hrs + Ethnicity, data = FireChange2 %>% 
                       .[-6, ])

PFNA.resid3<- ggplot(data.frame(resid = resid(model_PFNA3), 
                                fitted = fitted(model_PFNA3)), 
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "PFNAorig: total fireruns duration (hours)")
PFNA.resid3.rm <- ggplot(data.frame(resid = resid(model_PFNA3.rm), 
                                    fitted = fitted(model_PFNA3.rm)), 
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA3 <- list(PFNA.resid3, PFNA.resid3.rm)
print(ggarrange(plotlist = plotlist.PFNA3, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA3, model_PFNA3.rm, title = "PFNA: total fireruns duration (hours) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFNA: days.since.MRF
model_PFNA4 <- lm(PFNAorig ~  days.since.MRF + Ethnicity, data = FireChange2)
model_PFNA4.rm <- lm(PFNAorig ~  days.since.MRF + Ethnicity, data = FireChange2 %>%
                       .[-6, ])

PFNA.resid4<- ggplot(data.frame(resid = resid(model_PFNA4),
                                fitted = fitted(model_PFNA4)),
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "PFNAorig: days since most recent fire")
PFNA.resid4.rm <- ggplot(data.frame(resid = resid(model_PFNA4.rm),
                                    fitted = fitted(model_PFNA4.rm)),
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA4 <- list(PFNA.resid4, PFNA.resid4.rm)
print(ggarrange(plotlist = plotlist.PFNA4, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA4, model_PFNA4.rm, title = "PFNA: days since most recent fire -
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFNA: days.since.struc.MRF
model_PFNA5 <- lm(PFNAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2)
model_PFNA5.rm <- lm(PFNAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2 %>%
                       .[-6, ])

PFNA.resid5<- ggplot(data.frame(resid = resid(model_PFNA5),
                                fitted = fitted(model_PFNA5)),
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "PFNAorig: days since most recent structural fire")
PFNA.resid5.rm <- ggplot(data.frame(resid = resid(model_PFNA5.rm),
                                    fitted = fitted(model_PFNA5.rm)),
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA5 <- list(PFNA.resid5, PFNA.resid5.rm)
print(ggarrange(plotlist = plotlist.PFNA5, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA5, model_PFNA5.rm, title = "PFNA: days since most recent structural fire -
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#PFNA: time.since.baseline
model_PFNA6 <- lm(PFNAorig ~  time.since.baseline + Ethnicity, data = FireChange2)
model_PFNA6.rm <- lm(PFNAorig ~  time.since.baseline+ Ethnicity, data = FireChange2 %>%
                       .[-6, ])

PFNA.resid6<- ggplot(data.frame(resid = resid(model_PFNA6),
                                fitted = fitted(model_PFNA6)),
                     aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "PFNAorig: time since baseline (days)")
PFNA.resid6.rm <- ggplot(data.frame(resid = resid(model_PFNA6.rm),
                                    fitted = fitted(model_PFNA6.rm)),
                         aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-6, ]")

plotlist.PFNA6 <- list(PFNA.resid6, PFNA.resid6.rm)
print(ggarrange(plotlist = plotlist.PFNA6, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFNA6, model_PFNA6.rm, title = "PFNA: time since baseline (days) -
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

```

```{r check PFUA models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}

#PFUA: total.num.fireruns
model_PFUA <- lm(PFUAorig ~  total.num.fireruns + Ethnicity, data = FireChange2)
model_PFUA.rm <- lm(PFUAorig ~  total.num.fireruns + Ethnicity, data = FireChange2 %>% 
                       .[-9, ])

PFUA.resid<- ggplot(data.frame(resid = resid(model_PFUA), 
                                   fitted = fitted(model_PFUA)), 
                        aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +  
      labs(title = "PFUAorig: total number of fireruns")
    PFUA.resid.rm <- ggplot(data.frame(resid = resid(model_PFUA.rm), 
                                     fitted = fitted(model_PFUA.rm)), 
                          aes(x = fitted, y = resid)) +
      geom_point(size = 2) +
      geom_hline(yintercept = 0) +
      theme(axis.text = element_text(size = 10),
            plot.title = element_text(hjust = 0.5)) +
      labs(title = "Outliers removed [-9, ]")

plotlist.PFUA <- list(PFUA.resid, PFUA.resid.rm)
print(ggarrange(plotlist = plotlist.PFUA, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_PFUA, model_PFUA.rm, title = "PFUA: total number of fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

```

```{r check SbPFOA models with outliers removed, results = 'asis', fig.width = 8, fig.height = 11, eval = F}

#SbPFOA: total.num.fireruns
model_SbPFOA <- lm(SbPFOAorig ~  total.num.fireruns + Ethnicity, data = FireChange2)
model_SbPFOA.rm <- lm(SbPFOAorig ~  total.num.fireruns + Ethnicity, data = FireChange2 %>% 
                        .[-31, ])

SbPFOA.resid<- ggplot(data.frame(resid = resid(model_SbPFOA), 
                                 fitted = fitted(model_SbPFOA)), 
                      aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "SbPFOAorig: total number of fireruns")
SbPFOA.resid.rm <- ggplot(data.frame(resid = resid(model_SbPFOA.rm), 
                                     fitted = fitted(model_SbPFOA.rm)), 
                          aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ]")

plotlist.SbPFOA <- list(SbPFOA.resid, SbPFOA.resid.rm)
print(ggarrange(plotlist = plotlist.SbPFOA, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_SbPFOA, model_SbPFOA.rm, title = "SbPFOA: total number of fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#SbPFOA: str.num.fireruns
model_SbPFOA2 <- lm(SbPFOAorig ~  str.num.fireruns + Ethnicity, data = FireChange2)
model_SbPFOA2.rm <- lm(SbPFOAorig ~  str.num.fireruns + Ethnicity, data = FireChange2 %>% 
                         .[-31, ] %>%
                         .[-11, ])

SbPFOA2.resid<- ggplot(data.frame(resid = resid(model_SbPFOA2), 
                                  fitted = fitted(model_SbPFOA2)), 
                       aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "SbPFOAorig: total number of structural fireruns")
SbPFOA.resid2.rm <- ggplot(data.frame(resid = resid(model_SbPFOA2.rm), 
                                      fitted = fitted(model_SbPFOA2.rm)), 
                           aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-31, ], [-11, ]")

plotlist.SbPFOA2 <- list(SbPFOA2.resid, SbPFOA.resid2.rm)
print(ggarrange(plotlist = plotlist.SbPFOA2, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_SbPFOA2, model_SbPFOA2.rm, title = "SbPFOA: total number of structural fireruns - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


#SbPFOA: days.since.MRF
model_SbPFOA3 <- lm(SbPFOAorig ~  days.since.MRF + Ethnicity, data = FireChange2)
model_SbPFOA3.rm <- lm(SbPFOAorig ~  days.since.MRF + Ethnicity, data = FireChange2 %>% 
                         .[-11, ])

SbPFOA3.resid<- ggplot(data.frame(resid = resid(model_SbPFOA3), 
                                  fitted = fitted(model_SbPFOA3)), 
                       aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "SbPFOAorig: days since most recent fire")
SbPFOA.resid3.rm <- ggplot(data.frame(resid = resid(model_SbPFOA3.rm), 
                                      fitted = fitted(model_SbPFOA3.rm)), 
                           aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-11, ]")

plotlist.SbPFOA3 <- list(SbPFOA3.resid, SbPFOA.resid3.rm)
print(ggarrange(plotlist = plotlist.SbPFOA3, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_SbPFOA3, model_SbPFOA3.rm, title = "SbPFOA: days since most recent fire - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

#SbPFOA: days.since.struc.MRF
model_SbPFOA4 <- lm(SbPFOAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2)
model_SbPFOA4.rm <- lm(SbPFOAorig ~  days.since.struc.MRF + Ethnicity, data = FireChange2 %>% 
                         .[-11, ])

SbPFOA4.resid<- ggplot(data.frame(resid = resid(model_SbPFOA4), 
                                  fitted = fitted(model_SbPFOA4)), 
                       aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "SbPFOAorig: days since most recent structural fire")
SbPFOA.resid4.rm <- ggplot(data.frame(resid = resid(model_SbPFOA4.rm), 
                                      fitted = fitted(model_SbPFOA4.rm)), 
                           aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-11, ]")

plotlist.SbPFOA4 <- list(SbPFOA4.resid, SbPFOA.resid4.rm)
print(ggarrange(plotlist = plotlist.SbPFOA4, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_SbPFOA4, model_SbPFOA4.rm, title = "SbPFOA: days since most recent structural fire - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")


#SbPFOA: time.since.baseline
model_SbPFOA5 <- lm(SbPFOAorig ~  time.since.baseline + Ethnicity, data = FireChange2)
model_SbPFOA5.rm <- lm(SbPFOAorig ~  time.since.baseline + Ethnicity, data = FireChange2 %>%
                         .[-11, ])

SbPFOA5.resid<- ggplot(data.frame(resid = resid(model_SbPFOA5), 
                                  fitted = fitted(model_SbPFOA5)), 
                       aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +  
  labs(title = "SbPFOAorig: time since baseline (days)")
SbPFOA.resid5.rm <- ggplot(data.frame(resid = resid(model_SbPFOA5.rm), 
                                      fitted = fitted(model_SbPFOA5.rm)), 
                           aes(x = fitted, y = resid)) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0) +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Outliers removed [-11, ]")

plotlist.SbPFOA5 <- list(SbPFOA5.resid, SbPFOA.resid5.rm)
print(ggarrange(plotlist = plotlist.SbPFOA5, nrow = 2, ncol = 2, font.label = list(size = 10)))

stargazer(model_SbPFOA5, model_SbPFOA5.rm, title = "SbPFOA: time since baseline (days) - 
          Change Score Models - 1) original and 2) outliers removed",
          single.row = FALSE, header = FALSE, omit.stat = c("f", "ser"), report = "vctp*",
          intercept.bottom = FALSE, intercept.top = TRUE,
          digits = 3, font.size = "scriptsize")

```





<!-- add CD plots and DFBETA plots to forloop above to keep all relevant mdls together
interpret results
Write function for sensitivity analyses -->

```{r prep baseline PFAS for sensitivity models, eval = F}

#create new variables for:  
#1) baseline PFAS 
#2)tukey transformed baseline PFAS  (Julia's code from chunk "read_in_fire_change_debugging_Julia Tukey transformations")
#Remove females

base.PFAS <- FireChange %>%
    mutate_at(vars(contains("orig")), funs(base = ifelse(Status ==  'Recruit', ., NA))) %>%
    mutate(PFOSAtrans.tmp = PFOSAorig  + 11, # We will want to go back to min(.$PFOSAorig)
         nPFOAtrans.tmp = nPFOAorig + 11,  #AN, after adding min(.$) to all: "Error in in shapiro.test(TRANS) : all 'x' values are identical
         nPFOStrans.tmp = nPFOSorig + 11,
         PFDEAtrans.tmp = PFDEAorig + 11,
         PFHXStrans.tmp = PFHXSorig +  11,
         PFNAtrans.tmp = PFNAorig + 11, 
         PFUAtrans.tmp = PFUAorig + 11,
         SbPFOAtrans.tmp = SbPFOAorig + 11,
         SmPFOStrans.tmp = SmPFOSorig + 11) %>%
  mutate(PFOSAtrans = transformTukey(PFOSAtrans.tmp, plotit = F, quiet = T),
         nPFOAtrans = transformTukey(nPFOAtrans.tmp, plotit = F, quiet = T),
         nPFOStrans = transformTukey(nPFOStrans.tmp, plotit = F, quiet = T),
         PFDEAtrans = transformTukey(PFDEAtrans.tmp, plotit = F, quiet = T),
         PFHXStrans = transformTukey(PFHXStrans.tmp, plotit = F, quiet = T),
         PFNAtrans = transformTukey(PFNAtrans.tmp, plotit = F, quiet = T),
         PFUAtrans = transformTukey(PFUAtrans.tmp, plotit = F, quiet = T),
         SbPFOAtrans = transformTukey(SbPFOAtrans.tmp, plotit = F, quiet = T),
         SmPFOStrans = transformTukey(SmPFOStrans.tmp, plotit = F, quiet = T)) %>%
  mutate_at(vars(contains("trans")), funs(base = ifelse(Status ==  'Recruit', ., NA))) %>%
    mutate(str.duration.hrs = str.duration/60,
         total.duration.hrs = total.duration/60) %>%
  filter(Gender == "Male") 

# Note this for defining your lambdas if we use them again.
PFOSAlambda <- as.numeric(transformTukey(base.PFAS$PFOSAtrans.tmp, plotit = F, quiet = T, returnLambda = T)) 
nPFOAlambda <- as.numeric(transformTukey(base.PFAS$nPFOAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
nPFOSlambda <- as.numeric(transformTukey(base.PFAS$nPFOStrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFDEAlambda <- as.numeric(transformTukey(base.PFAS$PFDEAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFHXSlambda <- as.numeric(transformTukey(base.PFAS$PFHXStrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFNAlambda <- as.numeric(transformTukey(base.PFAS$PFNAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
PFUAlambda <- as.numeric(transformTukey(base.PFAS$PFUAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
SbPFOAlambda <- as.numeric(transformTukey(base.PFAS$SbPFOAtrans.tmp, plotit = F, quiet = T, returnLambda = T))
SmPFOSlambda <- as.numeric(transformTukey(base.PFAS$SmPFOStrans.tmp, plotit = F, quiet = T, returnLambda = T))

# #check that base variable and orig variable are identical
# base.check <- base.PFAS %>%
#   filter(Status == 'Recruit') #identical checks TRUE for all

                                


```


```{r Sensitivity model functions, results = 'asis', echo = F, dev = c('pdf', 'png'), fig.path = "figure/", eval = F}

#Sensitivity models for each PFAS/fire exposure combination: baseline PFAS measurement
#Sensitivity models for each PFAS/fire exposure combination: age and BMI

sens_ageBMI_fxn <- function(df, pfas, pfas.trans, fire.var) {
  pfas_orig <- paste0("pfasmdl <- lm(", pfas, " ~ ", fire.var, " + Ethnicity + Age + BMI, data = df)")
  eval(parse(text = pfas_orig))
  pfas_trans <- paste0("transmdl <- lm(", pfas.trans, " ~ ", fire.var, " + Ethnicity + Age + BMI, data = df)")
  eval(parse(text = pfas_trans))
  out <- list(pfasmdl = pfasmdl,
              transmdl = transmdl)
}


```


```{r baseline PFAS sensitivity model loop, results = "asis", eval = F}

#assuming we won't use time sine baseline, days since MRF, or days since structural MRF since our outcome variable is baseline PFAS

base_PFAS_fxn <-  function(dta, orig_outcome, trans_outcome, orig_base, exp_outcome) {
  orig_base_statement <- paste0("model_orig <- lm(", orig_outcome,
                                 " ~ ", exp_outcome, " + ", orig_base, " + Ethnicity, data = dta)")
  eval(parse(text = orig_base_statement))
  trans_base_statement <- paste0("model_trans <- lm(", trans_outcome, 
                                 " ~ ", exp_outcome, " + ", orig_base, " + Ethnicity, data = dta)")
  eval(parse(text = trans_base_statement))
  out <- list(model_orig = model_orig, 
              model_trans = model_trans)
}

analytes <- c("PFOSA", "nPFOA", "nPFOS", "PFDEA", "PFHXS", "PFNA", "PFUA", "SbPFOA", "SmPFOS")
exposures <- c("total.num.fireruns", "str.num.fireruns", "total.duration.hrs", "str.duration.hrs",
               "days.since.MRF", "days.since.struc.MRF", "time.since.baseline")
model_list <- list()
mean.change <- data.frame(Ethnicity = as.character(),
                          emmean = as.numeric(),
                          lower.CL = as.numeric(),
                          upper.CL = as.numeric(),
                          exposure = as.character(), 
                          analyte = as.character(),
                          stringsAsFactors = FALSE)


for (analyte in analytes) {
  model_list[[analyte]] <- list() 
  for (exposure in exposures) {
  orig_var <- paste0(analyte, "orig")
  trans_var <- paste0(analyte, "trans")
  orig_base <- paste0(analyte, ".baseline")
  out_info <- base_PFAS_fxn(FireChange, orig_var, trans_var, orig_base, exposure)
  model_list[[analyte]][[exposure]] <- out_info
  ggarrange(plot(resid(out_info$model_orig) ~ fitted(out_info$model_orig)) + abline(h = 0),
            plot(resid(out_info$model_trans) ~ fitted(out_info$model_trans)) + abline(h = 0),
            qqnorm(resid(out_info$model_orig)),
            qqnorm(resid(out_info$model_trans)),
            nrow = 2, ncol = 2)
  stargazer(out_info$model_orig, out_info$model_trans)
  }

                        
  stargazer(model_list[[analyte]][[exposures[1]]]$model_orig, 
            model_list[[analyte]][[exposures[2]]]$model_orig,
            model_list[[analyte]][[exposures[3]]]$model_orig,
            model_list[[analyte]][[exposures[4]]]$model_orig,
            title = "PFAS Change Score Model Results (No Transformation)", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            digits = 3, font.size = "scriptsize")
  stargazer(model_list[[analyte]][[exposures[5]]]$model_orig,
            model_list[[analyte]][[exposures[6]]]$model_orig,
            model_list[[analyte]][[exposures[7]]]$model_orig,
            title = "PFAS Change Score Model Results (No Transformation)", 
            single.row = FALSE, header = FALSE,
            omit.stat = c("f", "ser"), report = "vctp*", 
            intercept.bottom = FALSE, intercept.top = TRUE,
            digits = 3, font.size = "scriptsize")
}


  


```







<!-- For every change score models, get more diagnostic information (cooks distance, and dfbetas) for both original and transformed models: https://cran.r-project.org/web/packages/olsrr/vignettes/influence_measures.html

options: get rid of a point or two, or transform. would probably prefer to transform because we can leave the point in the model. 
Use ggarrange to condense the output a little

* Look through residuals.
* Get rid of age and bmi from change scores.
* Add in baseline pfas to each model as follow-up as sensitivity
* add each age & bmi as sensitivity
* Take women out. Done. still need to ask Dean about this.
* We have a month.
* I should look through Amys incumbent vs. new recruit info.
* Make sure longitudinal models are done
* need to do dichotomous models
* Think about how to control for multiple comparisons -->


